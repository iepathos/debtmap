{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://debtmap.io/schemas/unified-output-v1.json",
  "title": "Debtmap Unified Output Format",
  "description": "Schema for debtmap's unified debt item output format that handles both file-level and function-level technical debt",
  "type": "object",
  "required": ["metadata", "debt_items"],
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Analysis metadata and configuration",
      "required": ["version", "timestamp", "analysis_config"],
      "properties": {
        "version": {
          "type": "string",
          "description": "Debtmap version used for analysis",
          "pattern": "^\\d+\\.\\d+\\.\\d+"
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of analysis",
          "format": "date-time"
        },
        "analysis_config": {
          "type": "object",
          "description": "Configuration used for analysis",
          "properties": {
            "root_path": {
              "type": "string",
              "description": "Root directory of analyzed codebase"
            },
            "thresholds": {
              "type": "object",
              "description": "Complexity and risk thresholds",
              "properties": {
                "complexity": {
                  "type": "integer",
                  "minimum": 0
                },
                "cognitive_complexity": {
                  "type": "integer",
                  "minimum": 0
                },
                "risk_score": {
                  "type": "number",
                  "minimum": 0
                }
              }
            }
          }
        }
      }
    },
    "debt_items": {
      "type": "array",
      "description": "List of identified technical debt items",
      "items": {
        "$ref": "#/definitions/DebtItem"
      }
    },
    "summary": {
      "type": "object",
      "description": "Analysis summary statistics",
      "properties": {
        "total_items": {
          "type": "integer",
          "minimum": 0
        },
        "by_category": {
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          }
        },
        "by_severity": {
          "type": "object",
          "properties": {
            "high": {
              "type": "integer",
              "minimum": 0
            },
            "medium": {
              "type": "integer",
              "minimum": 0
            },
            "low": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    }
  },
  "definitions": {
    "DebtItem": {
      "type": "object",
      "description": "A single technical debt item (file-level or function-level)",
      "required": ["scope", "location", "category", "severity", "metrics"],
      "properties": {
        "scope": {
          "type": "string",
          "enum": ["file", "function"],
          "description": "Scope of the debt item"
        },
        "location": {
          "$ref": "#/definitions/Location",
          "description": "Code location information"
        },
        "category": {
          "type": "string",
          "enum": [
            "complexity",
            "god_object",
            "large_file",
            "duplicate_code",
            "test_coverage",
            "documentation",
            "error_handling",
            "security",
            "performance",
            "maintainability",
            "coupling",
            "cohesion"
          ],
          "description": "Technical debt category"
        },
        "severity": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Severity level of the debt"
        },
        "title": {
          "type": "string",
          "description": "Human-readable title"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the debt"
        },
        "metrics": {
          "$ref": "#/definitions/Metrics",
          "description": "Relevant metrics for this debt item"
        },
        "suggestions": {
          "type": "array",
          "description": "Refactoring suggestions",
          "items": {
            "type": "string"
          }
        },
        "related_items": {
          "type": "array",
          "description": "Related debt items (by index or ID)",
          "items": {
            "type": "integer",
            "minimum": 0
          }
        }
      }
    },
    "Location": {
      "type": "object",
      "description": "Code location information",
      "required": ["file_path"],
      "properties": {
        "file_path": {
          "type": "string",
          "description": "Relative path to the file"
        },
        "function_name": {
          "type": "string",
          "description": "Function name (for function-scoped items)"
        },
        "line_start": {
          "type": "integer",
          "minimum": 1,
          "description": "Starting line number"
        },
        "line_end": {
          "type": "integer",
          "minimum": 1,
          "description": "Ending line number"
        },
        "column_start": {
          "type": "integer",
          "minimum": 1,
          "description": "Starting column number"
        },
        "column_end": {
          "type": "integer",
          "minimum": 1,
          "description": "Ending column number"
        }
      }
    },
    "Metrics": {
      "type": "object",
      "description": "Metrics associated with a debt item",
      "properties": {
        "cyclomatic_complexity": {
          "type": "integer",
          "minimum": 0,
          "description": "Cyclomatic complexity"
        },
        "cognitive_complexity": {
          "type": "integer",
          "minimum": 0,
          "description": "Cognitive complexity"
        },
        "lines_of_code": {
          "type": "integer",
          "minimum": 0,
          "description": "Lines of code"
        },
        "nesting_depth": {
          "type": "integer",
          "minimum": 0,
          "description": "Maximum nesting depth"
        },
        "parameter_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of parameters (for functions)"
        },
        "function_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of functions (for files)"
        },
        "risk_score": {
          "type": "number",
          "minimum": 0,
          "description": "Calculated risk score"
        },
        "maintainability_index": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Maintainability index (0-100)"
        }
      }
    }
  }
}
