# HTML Dashboard Template Customization Guide

This guide explains how to customize the HTML dashboard template generated by debtmap's `--format html` output.

## Template Location

The HTML template is embedded in the debtmap binary at compile time from:
```
src/io/writers/templates/dashboard.html
```

## Customization Options

### 1. Modifying the Template Directly

To customize the dashboard appearance or functionality, edit the template file and rebuild debtmap:

```bash
# Edit the template
vim src/io/writers/templates/dashboard.html

# Rebuild debtmap
cargo build --release

# Generate HTML with your customizations
./target/release/debtmap analyze . --format html > report.html
```

### 2. Template Structure

The dashboard template consists of several key sections:

#### Header and Metadata
```html
<div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-4">
        Debtmap Analysis Dashboard - {{{PROJECT_NAME}}}
    </h1>
    ...
</div>
```

Variables available:
- `{{{PROJECT_NAME}}}` - Project directory path
- `{{{TIMESTAMP}}}` - Analysis timestamp
- `{{{TOTAL_ITEMS}}}` - Total technical debt items
- `{{{CRITICAL_COUNT}}}` - Critical priority count
- `{{{HIGH_COUNT}}}` - High priority count
- `{{{MEDIUM_COUNT}}}` - Medium priority count
- `{{{LOW_COUNT}}}` - Low priority count
- `{{{DEBT_DENSITY}}}` - Debt per 1K LOC
- `{{{TOTAL_FUNCTIONS}}}` - Total functions analyzed
- `{{{AVG_COMPLEXITY}}}` - Average complexity score
- `{{{JSON_DATA}}}` - Complete analysis results as JSON

#### Charts Section

The dashboard includes multiple Chart.js visualizations:

1. **Issue Distribution** - Pie chart of debt types
2. **Root Causes** - Bar chart of issue categories
3. **Complexity Scatter Plot** - X/Y plot of cyclomatic vs cognitive complexity
4. **Complexity Distribution** - Histogram showing complexity ranges
5. **Top Recommendations** - Horizontal bar of priority recommendations

#### Tables Section

Two interactive, sortable tables:

1. **God Objects Table** - Architectural debt items
2. **Complex Functions Table** - Functions sorted by complexity

### 3. Styling Customization

The dashboard uses [Tailwind CSS](https://tailwindcss.com/) via CDN. You can:

#### Change Colors

Edit the metric card border colors:
```css
.metric-card.critical { border-left-color: #EF4444; }  /* Red */
.metric-card.high { border-left-color: #F59E0B; }      /* Orange */
.metric-card.medium { border-left-color: #FBBF24; }    /* Yellow */
.metric-card.low { border-left-color: #10B981; }       /* Green */
```

#### Modify Chart Colors

Update the color schemes in the chart configurations:
```javascript
backgroundColor: [
    'rgba(16, 185, 129, 0.7)',  // Green
    'rgba(251, 191, 36, 0.7)',  // Yellow
    'rgba(245, 158, 11, 0.7)',  // Orange
    'rgba(239, 68, 68, 0.7)'    // Red
]
```

#### Add Custom CSS

Insert custom styles in the `<style>` section:
```html
<style>
    /* Your custom styles */
    .custom-class {
        /* Custom properties */
    }
</style>
```

### 4. Adding New Charts

To add a new chart:

1. **Add HTML container:**
```html
<div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold mb-4">My Custom Chart</h2>
    <div class="chart-container">
        <canvas id="myCustomChart"></canvas>
    </div>
</div>
```

2. **Add Chart.js initialization:**
```javascript
new Chart(document.getElementById('myCustomChart'), {
    type: 'bar',  // or 'line', 'pie', 'doughnut', 'scatter', etc.
    data: {
        labels: ['Label 1', 'Label 2'],
        datasets: [{
            label: 'My Data',
            data: [10, 20],
            backgroundColor: 'rgba(99, 102, 241, 0.7)'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});
```

3. **Extract data from `debtData`:**
```javascript
function extractMyData(data) {
    // Process data.complexity, data.technical_debt, etc.
    return processedData;
}
```

### 5. Modifying Tables

#### Add New Columns

Edit the table header:
```html
<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
    New Column
</th>
```

Add corresponding data cells in the JavaScript:
```javascript
row.insertCell().textContent = metric.newProperty;
```

#### Customize Sorting

The tables use a simple click-to-sort implementation. Modify the `makeSortable()` function to change sorting behavior.

### 6. Search and Filter Customization

The function search box can be customized:

```javascript
document.getElementById('searchBox').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    // Custom search logic
});
```

### 7. JSON Data Structure

The `debtData` object contains:

```javascript
{
    "project_path": "/path/to/project",
    "timestamp": "2024-11-22T10:30:00Z",
    "complexity": {
        "metrics": [
            {
                "name": "function_name",
                "file": "path/to/file.rs",
                "line": 42,
                "cyclomatic": 15,
                "cognitive": 20,
                "nesting": 3,
                "length": 50
            }
        ],
        "summary": {
            "total_functions": 100,
            "average_complexity": 12.5,
            "max_complexity": 50,
            "high_complexity_count": 10
        }
    },
    "technical_debt": {
        "items": [
            {
                "id": "debt-1",
                "debt_type": "Complexity",
                "priority": "High",
                "file": "src/main.rs",
                "line": 10,
                "message": "High complexity detected"
            }
        ]
    }
}
```

Use this structure to create custom visualizations or tables.

## Best Practices

### 1. Keep Templates Self-Contained

The HTML file should work standalone without requiring external files (except CDN resources). This makes it easy to share reports.

### 2. Test XSS Protection

If you add custom data rendering, ensure HTML escaping is applied:
```javascript
// Good: Text content is automatically escaped
element.textContent = userInput;

// Risky: HTML injection possible
element.innerHTML = userInput;  // Only use with sanitized data
```

### 3. Maintain Responsiveness

Test your customizations on different screen sizes:
```css
/* Mobile-first approach */
.my-custom-element {
    width: 100%;
}

/* Tablet and up */
@media (min-width: 768px) {
    .my-custom-element {
        width: 50%;
    }
}
```

### 4. Performance Considerations

- Limit the number of rendered table rows for large datasets
- Use pagination for tables with 100+ items
- Debounce search input handlers

## Example Customizations

### Adding a Complexity Trend Line

```javascript
// Add after existing charts
new Chart(document.getElementById('complexityTrend'), {
    type: 'line',
    data: {
        labels: debtData.complexity.metrics.map(m => m.name),
        datasets: [{
            label: 'Complexity Trend',
            data: debtData.complexity.metrics.map(m => m.cyclomatic),
            borderColor: 'rgb(99, 102, 241)',
            tension: 0.1
        }]
    }
});
```

### Custom Priority Color Scheme

```css
.metric-card.critical { border-left-color: #DC2626; }  /* Darker red */
.metric-card.high { border-left-color: #EA580C; }      /* Darker orange */
.metric-card.medium { border-left-color: #CA8A04; }    /* Darker yellow */
.metric-card.low { border-left-color: #059669; }       /* Darker green */
```

### Add Export to CSV Button

```html
<button onclick="exportToCSV()" class="px-4 py-2 bg-blue-600 text-white rounded">
    Export to CSV
</button>

<script>
function exportToCSV() {
    const rows = [['Function', 'File', 'Cyclomatic', 'Cognitive']];
    debtData.complexity.metrics.forEach(m => {
        rows.push([m.name, m.file, m.cyclomatic, m.cognitive]);
    });
    const csv = rows.map(r => r.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'debtmap-report.csv';
    a.click();
}
</script>
```

## Troubleshooting

### Charts Not Rendering

1. Check browser console for JavaScript errors
2. Ensure Chart.js CDN is accessible
3. Verify data extraction functions return valid data structures

### Tables Empty

1. Check that `debtData` is populated (inspect in browser console)
2. Verify table population logic in JavaScript
3. Ensure JSON parsing succeeded

### Styling Issues

1. Verify Tailwind CSS CDN is loaded
2. Check for conflicting CSS rules
3. Test in multiple browsers for compatibility

## Contributing Template Improvements

If you create useful customizations, consider contributing them back to debtmap:

1. Fork the repository
2. Modify `src/io/writers/templates/dashboard.html`
3. Test thoroughly
4. Submit a pull request with description and screenshots

## Further Resources

- [Chart.js Documentation](https://www.chartjs.org/docs/latest/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Debtmap GitHub Repository](https://github.com/iepathos/debtmap)
- [HTML Dashboard Spec (Spec 194)](../specs/194-html-output-format.md)
