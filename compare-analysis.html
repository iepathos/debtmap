<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Compare Analysis - Debtmap Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive guide to Debtmap code complexity and technical debt analyzer">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>‚Üê</kbd> or <kbd>‚Üí</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Debtmap Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/iepathos/debtmap" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="compare-analysis"><a class="header" href="#compare-analysis">Compare Analysis</a></h1>
<p>The <code>compare</code> command enables you to track technical debt changes over time by comparing two analysis results. This is essential for validating refactoring efforts, detecting regressions in pull requests, and monitoring project health trends.</p>
<h2 id="implementation-status"><a class="header" href="#implementation-status">Implementation Status</a></h2>
<p><strong>All Features Available Now</strong>:</p>
<ul>
<li>‚úÖ Target location tracking with intelligent fuzzy matching</li>
<li>‚úÖ Detailed improvement percentage calculations (per-item)</li>
<li>‚úÖ Multiple output formats (JSON, Markdown, Terminal)</li>
<li>‚úÖ Implementation plan parsing for target extraction</li>
<li>‚úÖ Four match strategies (Exact, FunctionLevel, ApproximateName, FileLevel)</li>
<li>‚úÖ Resolved items tracking (debt eliminated)</li>
<li>‚úÖ Improved items detection (score reduction ‚â• 30%)</li>
<li>‚úÖ New critical items detection (regressions)</li>
<li>‚úÖ Project health metrics and trends</li>
<li>‚úÖ CI/CD integration support</li>
</ul>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The compare command analyzes differences between ‚Äúbefore‚Äù and ‚Äúafter‚Äù debtmap analyses, providing:</p>
<ul>
<li><strong>Target location tracking</strong> - Monitor specific code locations through refactoring with fuzzy matching</li>
<li><strong>Validation tracking</strong> - Verify debt items are resolved or improved</li>
<li><strong>Project health metrics</strong> - Track overall debt trends across your codebase</li>
<li><strong>Regression detection</strong> - Identify new critical debt items introduced (score ‚â• 60.0)</li>
<li><strong>Improvement tracking</strong> - Measure and celebrate debt reduction with detailed per-item metrics</li>
<li><strong>CI/CD integration</strong> - Automate quality gates in your pipeline</li>
</ul>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h2>
<h3 id="command-syntax"><a class="header" href="#command-syntax">Command Syntax</a></h3>
<pre><code class="language-bash">debtmap compare \
  --before path/to/before.json \
  --after path/to/after.json \
  --output validation.json
</code></pre>
<h3 id="command-line-options"><a class="header" href="#command-line-options">Command-Line Options</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Option</th><th>Required</th><th>Description</th></tr></thead><tbody>
<tr><td><code>--before FILE</code></td><td>Yes</td><td>Path to ‚Äúbefore‚Äù analysis JSON</td></tr>
<tr><td><code>--after FILE</code></td><td>Yes</td><td>Path to ‚Äúafter‚Äù analysis JSON</td></tr>
<tr><td><code>--output FILE</code></td><td>No</td><td>Output file path (default: stdout)</td></tr>
<tr><td><code>--plan FILE</code></td><td>No</td><td>Implementation plan to extract target location</td></tr>
<tr><td><code>--target-location LOCATION</code></td><td>No</td><td>Manual target location (format: <code>file:function:line</code>)</td></tr>
<tr><td><code>--format FORMAT</code></td><td>No</td><td>Output format: <code>json</code>, <code>markdown</code>, or <code>terminal</code> (default: json)</td></tr>
</tbody></table>
</div>
<p>All comparison features are available now, including target location tracking, fuzzy matching, and multiple output formats.</p>
<h2 id="target-location-tracking"><a class="header" href="#target-location-tracking">Target Location Tracking</a></h2>
<p>Target location tracking allows you to monitor specific code locations through refactoring changes. The compare command uses intelligent fuzzy matching to find your target even when code is moved or renamed.</p>
<h3 id="location-format"><a class="header" href="#location-format">Location Format</a></h3>
<p>Target locations use the format: <code>file:function:line</code></p>
<p>Examples:</p>
<ul>
<li><code>src/main.rs:complex_function:42</code></li>
<li><code>lib/parser.rs:parse_expression:156</code></li>
<li><code>api/handler.rs:process_request:89</code></li>
</ul>
<h3 id="specifying-target-locations"><a class="header" href="#specifying-target-locations">Specifying Target Locations</a></h3>
<h4 id="option-1-via-implementation-plan"><a class="header" href="#option-1-via-implementation-plan">Option 1: Via Implementation Plan</a></h4>
<p>Create an <code>IMPLEMENTATION_PLAN.md</code> file with a target location section:</p>
<pre><code class="language-markdown"># Implementation Plan

## Target Item
**Location**: ./src/example.rs:complex_function:45
**Current Debt Score**: 85.5
**Severity**: critical

## Problem Analysis
The `complex_function` has high cognitive complexity...

## Proposed Solution
1. Extract nested conditionals into separate functions
2. Use early returns to reduce nesting depth
3. Add comprehensive unit tests
</code></pre>
<p>Then run compare with the plan:</p>
<pre><code class="language-bash">debtmap compare --before before.json --after after.json --plan IMPLEMENTATION_PLAN.md
</code></pre>
<h4 id="option-2-manual-target-location"><a class="header" href="#option-2-manual-target-location">Option 2: Manual Target Location</a></h4>
<p>Specify the target directly via command-line:</p>
<pre><code class="language-bash">debtmap compare \
  --before before.json \
  --after after.json \
  --target-location "src/example.rs:complex_function:45"
</code></pre>
<h3 id="matching-strategies"><a class="header" href="#matching-strategies">Matching Strategies</a></h3>
<p>Debtmap uses intelligent matching to find your target item even when code changes. The matcher tries multiple strategies in order, using the most precise match available:</p>
<div class="table-wrapper"><table><thead><tr><th>Strategy</th><th>When Used</th><th>Confidence</th></tr></thead><tbody>
<tr><td><strong>Exact</strong></td><td><code>file:function:line</code> matches exactly</td><td>1.0</td></tr>
<tr><td><strong>FunctionLevel</strong></td><td><code>file:function</code> matches (any line)</td><td>0.8</td></tr>
<tr><td><strong>ApproximateName</strong></td><td>Fuzzy name matching finds similar function</td><td>0.6</td></tr>
<tr><td><strong>FileLevel</strong></td><td>All items in file match</td><td>0.4</td></tr>
</tbody></table>
</div>
<p>The comparison result includes the match strategy and confidence score used, along with the count of matched items (useful when fuzzy matching finds multiple candidates).</p>
<h3 id="target-status-values"><a class="header" href="#target-status-values">Target Status Values</a></h3>
<p>After comparing, the target item will have one of these statuses:</p>
<ul>
<li><strong>Resolved</strong> - Item no longer exists in after analysis (debt eliminated!)</li>
<li><strong>Improved</strong> - Item exists but with lower debt score</li>
<li><strong>Unchanged</strong> - Item exists with similar metrics (within 5%)</li>
<li><strong>Regressed</strong> - Item exists but got worse</li>
<li><strong>NotFoundBefore</strong> - Item didn‚Äôt exist in before analysis</li>
<li><strong>NotFound</strong> - Item not found in either analysis</li>
</ul>
<h2 id="project-health-metrics"><a class="header" href="#project-health-metrics">Project Health Metrics</a></h2>
<p>The compare command tracks project-wide health metrics to show overall trends.</p>
<h3 id="tracked-metrics"><a class="header" href="#tracked-metrics">Tracked Metrics</a></h3>
<pre><code class="language-json">{
  "project_health": {
    "before": {
      "total_debt_score": 450.5,
      "total_items": 25,
      "critical_items": 5,
      "high_priority_items": 12,
      "average_score": 18.02
    },
    "after": {
      "total_debt_score": 380.2,
      "total_items": 22,
      "critical_items": 3,
      "high_priority_items": 10,
      "average_score": 17.28
    },
    "changes": {
      "debt_score_change": -70.3,
      "debt_score_change_pct": -15.6,
      "items_change": -3,
      "critical_items_change": -2
    }
  }
}
</code></pre>
<h3 id="understanding-metrics"><a class="header" href="#understanding-metrics">Understanding Metrics</a></h3>
<ul>
<li><strong>total_debt_score</strong> - Sum of all debt item scores</li>
<li><strong>total_items</strong> - Total number of debt items detected</li>
<li><strong>critical_items</strong> - Items with score ‚â• 60.0 (critical threshold)</li>
<li><strong>high_priority_items</strong> - Items with score ‚â• 40.0 (high priority threshold)</li>
<li><strong>average_score</strong> - Mean debt score across all items</li>
<li><strong>debt_score_change</strong> - Absolute change in total debt</li>
<li><strong>debt_score_change_pct</strong> - Percentage change in total debt</li>
</ul>
<h3 id="debt-trends"><a class="header" href="#debt-trends">Debt Trends</a></h3>
<p>The comparison calculates an overall debt trend based on the percentage change:</p>
<ul>
<li><strong>Improving</strong> - Debt decreased by more than 5%</li>
<li><strong>Stable</strong> - Debt changed by less than 5% (within normal variance)</li>
<li><strong>Regressing</strong> - Debt increased by more than 5%</li>
</ul>
<h2 id="regression-detection"><a class="header" href="#regression-detection">Regression Detection</a></h2>
<p>Regressions are new critical debt items (score ‚â• 60.0) that appear in the after analysis.</p>
<h3 id="what-counts-as-a-regression"><a class="header" href="#what-counts-as-a-regression">What Counts as a Regression</a></h3>
<p>A regression is detected when:</p>
<ol>
<li>An item exists in the after analysis</li>
<li>The item does NOT exist in the before analysis</li>
<li>The item has a debt score ‚â• 60.0 (critical severity threshold)</li>
</ol>
<h3 id="regression-output"><a class="header" href="#regression-output">Regression Output</a></h3>
<p>The compare command returns a <code>ComparisonResult</code> with detailed regression information:</p>
<pre><code class="language-json">{
  "regressions": [
    {
      "location": "src/new_feature.rs:process_data:23",
      "score": 65.5,
      "debt_type": "high_complexity",
      "description": "Function has cyclomatic complexity of 12 and cognitive complexity of 15"
    }
  ]
}
</code></pre>
<p>Each regression item includes:</p>
<ul>
<li><strong>location</strong> - Full path with function and line number</li>
<li><strong>score</strong> - Debt score (‚â• 60.0 for regressions)</li>
<li><strong>debt_type</strong> - Type of debt detected (e.g., ‚Äúhigh_complexity‚Äù, ‚Äúgod_object‚Äù)</li>
<li><strong>description</strong> - Human-readable explanation of the issue</li>
</ul>
<h3 id="using-regressions-in-cicd"><a class="header" href="#using-regressions-in-cicd">Using Regressions in CI/CD</a></h3>
<p>Fail your CI build if regressions are detected:</p>
<pre><code class="language-bash"># Run comparison
debtmap compare --before before.json --after after.json --output result.json

# Check for regressions
REGRESSION_COUNT=$(jq '.regressions | length' result.json)

if [ "$REGRESSION_COUNT" -gt 0 ]; then
  echo "‚ùå Regression detected - $REGRESSION_COUNT new critical debt items found"
  jq '.regressions[]' result.json
  exit 1
fi

# Check overall debt trend
TREND=$(jq -r '.summary.overall_debt_trend' result.json)
if [ "$TREND" = "Regressing" ]; then
  echo "‚ö†Ô∏è Warning: Overall debt is increasing"
fi
</code></pre>
<h2 id="improvement-tracking"><a class="header" href="#improvement-tracking">Improvement Tracking</a></h2>
<p>The compare command tracks improvements as a list of <code>ImprovementItem</code> objects with detailed before/after metrics.</p>
<h3 id="improvement-types"><a class="header" href="#improvement-types">Improvement Types</a></h3>
<p>The <code>improvement_type</code> field indicates the kind of improvement:</p>
<ul>
<li><strong>Resolved</strong> - Debt item completely eliminated (no longer in after analysis)</li>
<li><strong>ScoreReduced</strong> - Overall debt score reduced significantly (‚â• 30% reduction)</li>
<li><strong>ComplexityReduced</strong> - Cyclomatic or cognitive complexity decreased</li>
<li><strong>CoverageImproved</strong> - Test coverage increased</li>
</ul>
<h3 id="improvement-items-structure"><a class="header" href="#improvement-items-structure">Improvement Items Structure</a></h3>
<pre><code class="language-json">{
  "improvements": [
    {
      "location": "src/example.rs:complex_function:45",
      "before_score": 68.5,
      "after_score": 35.2,
      "improvement_type": "ScoreReduced"
    },
    {
      "location": "src/legacy.rs:old_code:120",
      "before_score": 72.0,
      "after_score": null,
      "improvement_type": "Resolved"
    },
    {
      "location": "src/utils.rs:helper_function:88",
      "before_score": 45.0,
      "after_score": 28.0,
      "improvement_type": "ComplexityReduced"
    }
  ]
}
</code></pre>
<p>Each improvement item includes:</p>
<ul>
<li><strong>location</strong> - Full path with function and line number</li>
<li><strong>before_score</strong> - Original debt score</li>
<li><strong>after_score</strong> - New debt score (null if resolved)</li>
<li><strong>improvement_type</strong> - Type of improvement achieved</li>
</ul>
<h2 id="beforeafter-metrics"><a class="header" href="#beforeafter-metrics">Before/After Metrics</a></h2>
<p>When you specify a target location (via <code>--plan</code> or <code>--target-location</code>), the compare command provides detailed before/after metrics for that specific code location.</p>
<h3 id="target-item-comparison"><a class="header" href="#target-item-comparison">Target Item Comparison</a></h3>
<pre><code class="language-json">{
  "target_item": {
    "location": "src/example.rs:complex_function:45",
    "match_strategy": "Exact",
    "match_confidence": 1.0,
    "matched_items_count": 1,
    "before": {
      "score": 68.5,
      "cyclomatic_complexity": 8,
      "cognitive_complexity": 15,
      "coverage": 45.0,
      "function_length": 120,
      "nesting_depth": 4
    },
    "after": {
      "score": 35.1,
      "cyclomatic_complexity": 3,
      "cognitive_complexity": 5,
      "coverage": 85.0,
      "function_length": 45,
      "nesting_depth": 2
    },
    "improvements": {
      "score_reduction_pct": 48.8,
      "complexity_reduction_pct": 66.7,
      "coverage_improvement_pct": 88.9
    },
    "status": "Improved"
  }
}
</code></pre>
<h3 id="target-metrics-fields"><a class="header" href="#target-metrics-fields">Target Metrics Fields</a></h3>
<p>Each <code>TargetMetrics</code> object (before/after) includes:</p>
<ul>
<li><strong>score</strong> - Unified debt score</li>
<li><strong>cyclomatic_complexity</strong> - Cyclomatic complexity metric</li>
<li><strong>cognitive_complexity</strong> - Cognitive complexity metric</li>
<li><strong>coverage</strong> - Test coverage percentage</li>
<li><strong>function_length</strong> - Lines of code in function</li>
<li><strong>nesting_depth</strong> - Maximum nesting depth</li>
</ul>
<h3 id="improvement-percentages"><a class="header" href="#improvement-percentages">Improvement Percentages</a></h3>
<p>The <code>improvements</code> object provides percentage improvements:</p>
<ul>
<li><strong>score_reduction_pct</strong> - Percentage reduction in overall debt score</li>
<li><strong>complexity_reduction_pct</strong> - Reduction in cyclomatic/cognitive complexity</li>
<li><strong>coverage_improvement_pct</strong> - Increase in test coverage</li>
</ul>
<h3 id="metric-aggregation"><a class="header" href="#metric-aggregation">Metric Aggregation</a></h3>
<p>When multiple items match the target location (due to fuzzy matching), metrics are aggregated:</p>
<ul>
<li><strong>score</strong> - Average across matched items</li>
<li><strong>cyclomatic_complexity</strong> - Average</li>
<li><strong>cognitive_complexity</strong> - Average</li>
<li><strong>coverage</strong> - Average</li>
<li><strong>function_length</strong> - Average</li>
<li><strong>nesting_depth</strong> - Maximum (worst case)</li>
</ul>
<p>The <code>matched_items_count</code> field tells you how many items were aggregated.</p>
<h3 id="validating-refactoring-success"><a class="header" href="#validating-refactoring-success">Validating Refactoring Success</a></h3>
<p>Use the comparison output to verify your refactoring:</p>
<pre><code class="language-bash"># Check target status
STATUS=$(jq -r '.target_item.status' result.json)
SCORE_REDUCTION=$(jq '.target_item.improvements.score_reduction_pct' result.json)

echo "Target Status: $STATUS"
echo "Score Reduction: ${SCORE_REDUCTION}%"

# Check for improvements
IMPROVEMENT_COUNT=$(jq '.improvements | length' result.json)
echo "Improvements: $IMPROVEMENT_COUNT items"

# Verify no regressions
REGRESSION_COUNT=$(jq '.regressions | length' result.json)
if [ "$REGRESSION_COUNT" -eq 0 ]; then
  echo "‚úÖ No regressions detected!"
else
  echo "‚ö†Ô∏è $REGRESSION_COUNT new critical items"
fi
</code></pre>
<h2 id="output-formats"><a class="header" href="#output-formats">Output Formats</a></h2>
<h3 id="json-format"><a class="header" href="#json-format">JSON Format</a></h3>
<p>The default JSON format provides complete comparison results:</p>
<pre><code class="language-bash">debtmap compare --before before.json --after after.json --output result.json
</code></pre>
<p>The <code>ComparisonResult</code> JSON output includes:</p>
<ul>
<li><code>metadata</code> - Comparison metadata (date, file paths, target location)</li>
<li><code>target_item</code> - Target item comparison with before/after metrics (if specified)</li>
<li><code>project_health</code> - Project-wide health metrics comparison</li>
<li><code>regressions</code> - List of new critical items</li>
<li><code>improvements</code> - List of improved/resolved items</li>
<li><code>summary</code> - Summary statistics and overall debt trend</li>
</ul>
<p>Example output:</p>
<pre><code class="language-json">{
  "metadata": {
    "comparison_date": "2024-01-15T10:30:00Z",
    "before_file": "before.json",
    "after_file": "after.json",
    "target_location": "src/example.rs:complex_function:45"
  },
  "target_item": {
    "status": "Improved",
    "improvements": {
      "score_reduction_pct": 48.8
    }
  },
  "summary": {
    "target_improved": true,
    "new_critical_count": 0,
    "resolved_count": 3,
    "overall_debt_trend": "Improving"
  }
}
</code></pre>
<h3 id="markdown-format"><a class="header" href="#markdown-format">Markdown Format</a></h3>
<p>Generate human-readable markdown reports for pull request comments:</p>
<pre><code class="language-bash">debtmap compare --before before.json --after after.json --format markdown
</code></pre>
<p>The markdown output is suitable for:</p>
<ul>
<li>Pull request comments</li>
<li>Documentation</li>
<li>Email reports</li>
<li>Team dashboards</li>
</ul>
<h3 id="terminal-format"><a class="header" href="#terminal-format">Terminal Format</a></h3>
<p>Display colorized output directly in the terminal:</p>
<pre><code class="language-bash">debtmap compare --before before.json --after after.json --format terminal
</code></pre>
<p>The terminal format provides:</p>
<ul>
<li>Color-coded status indicators</li>
<li>Formatted tables for metrics</li>
<li>Human-readable summaries</li>
<li>Easy scanning of results</li>
</ul>
<h2 id="cicd-integration"><a class="header" href="#cicd-integration">CI/CD Integration</a></h2>
<h3 id="github-actions-example"><a class="header" href="#github-actions-example">GitHub Actions Example</a></h3>
<pre><code class="language-yaml">name: Technical Debt Check

on: [pull_request]

jobs:
  debt-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Need history for before/after

      - name: Install debtmap
        run: cargo install debtmap

      - name: Analyze main branch
        run: |
          git checkout main
          debtmap analyze --output before.json

      - name: Analyze PR branch
        run: |
          git checkout ${{ github.head_ref }}
          debtmap analyze --output after.json

      - name: Compare analyses
        run: |
          debtmap compare \
            --before before.json \
            --after after.json \
            --output comparison.json

      - name: Check comparison result
        run: |
          TREND=$(jq -r '.summary.overall_debt_trend' comparison.json)
          REGRESSION_COUNT=$(jq '.regressions | length' comparison.json)
          IMPROVEMENT_COUNT=$(jq '.improvements | length' comparison.json)

          echo "Debt Trend: $TREND"
          echo "Regressions: $REGRESSION_COUNT"
          echo "Improvements: $IMPROVEMENT_COUNT"

          # Fail on regression
          if [ "$REGRESSION_COUNT" -gt 0 ]; then
            echo "‚ùå Regression detected"
            jq '.regressions[]' comparison.json
            exit 1
          fi

          # Warn if debt is increasing
          if [ "$TREND" = "Regressing" ]; then
            echo "‚ö†Ô∏è Warning: Overall debt is increasing"
          fi

      - name: Post comparison to PR
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const comparison = JSON.parse(fs.readFileSync('comparison.json', 'utf8'));

            const body = `## Technical Debt Comparison

            **Overall Trend:** ${comparison.summary.overall_debt_trend}
            **Regressions:** ${comparison.summary.new_critical_count}
            **Improvements:** ${comparison.summary.resolved_count}

            ${comparison.improvements.length &gt; 0 ? `
            ### Improvements
            ${comparison.improvements.map(i =&gt; `- ${i.location}: ${i.before_score.toFixed(1)} ‚Üí ${i.after_score ? i.after_score.toFixed(1) : 'resolved'}`).join('\n')}
            ` : ''}

            ${comparison.regressions.length &gt; 0 ? `
            ### ‚ö†Ô∏è Regressions
            ${comparison.regressions.map(r =&gt; `- ${r.location}: ${r.score.toFixed(1)} (${r.debt_type})`).join('\n')}
            ` : ''}`;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: body
            });
</code></pre>
<h3 id="gitlab-ci-example"><a class="header" href="#gitlab-ci-example">GitLab CI Example</a></h3>
<pre><code class="language-yaml">debt_check:
  stage: test
  script:
    # Analyze main branch
    - git fetch origin main
    - git checkout origin/main
    - debtmap analyze --output before.json

    # Analyze current branch
    - git checkout $CI_COMMIT_SHA
    - debtmap analyze --output after.json

    # Compare and check status
    - debtmap compare --before before.json --after after.json --output comparison.json
    - |
      TREND=$(jq -r '.summary.overall_debt_trend' comparison.json)
      REGRESSION_COUNT=$(jq '.regressions | length' comparison.json)

      echo "Debt Trend: $TREND"
      echo "Regressions: $REGRESSION_COUNT"

      if [ "$REGRESSION_COUNT" -gt 0 ]; then
        echo "Failed: Regression detected"
        jq '.regressions[]' comparison.json
        exit 1
      fi
  artifacts:
    paths:
      - before.json
      - after.json
      - comparison.json
    expire_in: 1 week
</code></pre>
<h3 id="best-practices-for-cicd"><a class="header" href="#best-practices-for-cicd">Best Practices for CI/CD</a></h3>
<ol>
<li><strong>Store analyses as artifacts</strong> - Keep before/after JSON for debugging</li>
<li><strong>Check status field</strong> - Use <code>status</code> to determine pass/fail</li>
<li><strong>Track completion percentage</strong> - Monitor progress toward debt resolution</li>
<li><strong>Review improvements</strong> - Celebrate and document successful refactorings</li>
<li><strong>Act on remaining issues</strong> - Create follow-up tasks for unresolved items</li>
<li><strong>Set completion thresholds</strong> - Require minimum completion percentage for merges</li>
</ol>
<h2 id="practical-examples"><a class="header" href="#practical-examples">Practical Examples</a></h2>
<h3 id="example-1-basic-comparison"><a class="header" href="#example-1-basic-comparison">Example 1: Basic Comparison</a></h3>
<p>Compare two analyses to track debt changes:</p>
<pre><code class="language-bash"># Run before analysis
debtmap analyze --output before.json

# Make changes to codebase...

# Run after analysis
debtmap analyze --output after.json

# Compare
debtmap compare --before before.json --after after.json --output comparison.json

# Check results
cat comparison.json | jq '.'
# Output shows: target_item, project_health, regressions, improvements, summary
</code></pre>
<h3 id="example-2-validating-function-refactoring"><a class="header" href="#example-2-validating-function-refactoring">Example 2: Validating Function Refactoring</a></h3>
<p>Validate your refactoring work with target location tracking:</p>
<pre><code class="language-bash"># Run before analysis
debtmap analyze --output before.json

# Identify critical items to fix
jq '.items[] | select(.unified_score.final_score &gt;= 60.0)' before.json

# Refactor the high-priority functions...

# Run after analysis
debtmap analyze --output after.json

# Compare and validate with target location
debtmap compare \
  --before before.json \
  --after after.json \
  --target-location "src/example.rs:complex_function:45" \
  --output comparison.json

# Check target status
STATUS=$(jq -r '.target_item.status' comparison.json)
SCORE_REDUCTION=$(jq '.target_item.improvements.score_reduction_pct' comparison.json)

echo "Target Status: $STATUS"
echo "Score Reduction: ${SCORE_REDUCTION}%"

# Review all improvements
jq '.improvements[]' comparison.json
</code></pre>
<h3 id="example-3-detecting-pr-regressions"><a class="header" href="#example-3-detecting-pr-regressions">Example 3: Detecting PR Regressions</a></h3>
<p>Check if a pull request introduces new critical debt:</p>
<pre><code class="language-bash"># Analyze base branch
git checkout main
debtmap analyze --output main.json

# Analyze PR branch
git checkout feature/new-feature
debtmap analyze --output feature.json

# Compare
debtmap compare \
  --before main.json \
  --after feature.json \
  --output comparison.json

# Check for regressions
REGRESSION_COUNT=$(jq '.regressions | length' comparison.json)
TREND=$(jq -r '.summary.overall_debt_trend' comparison.json)

echo "Regressions: $REGRESSION_COUNT"
echo "Debt Trend: $TREND"

# Example output structure:
jq '.' comparison.json
# {
#   "summary": {
#     "overall_debt_trend": "Improving",  // or "Regressing"
#     "new_critical_count": 0,
#     "resolved_count": 3
#   },
#   "regressions": [],
#   "improvements": [...],
#   "project_health": {...}
# }
</code></pre>
<h3 id="example-4-monitoring-project-health-over-releases"><a class="header" href="#example-4-monitoring-project-health-over-releases">Example 4: Monitoring Project Health Over Releases</a></h3>
<p>Track overall project health across releases:</p>
<pre><code class="language-bash"># Analyze release v1.0
git checkout v1.0
debtmap analyze --output v1.0.json

# Analyze release v1.1
git checkout v1.1
debtmap analyze --output v1.1.json

# Compare
debtmap compare \
  --before v1.0.json \
  --after v1.1.json \
  --output v1.0-to-v1.1.json

# Check project health metrics
echo "Before (v1.0):"
jq '.project_health.before' v1.0-to-v1.1.json

echo "After (v1.1):"
jq '.project_health.after' v1.0-to-v1.1.json

# Check overall trend
TREND=$(jq -r '.summary.overall_debt_trend' v1.0-to-v1.1.json)
DEBT_CHANGE=$(jq '.project_health.changes.debt_score_change_pct' v1.0-to-v1.1.json)
echo "Debt Trend: $TREND"
echo "Debt Score Change: ${DEBT_CHANGE}%"
</code></pre>
<h3 id="example-5-full-cicd-workflow"><a class="header" href="#example-5-full-cicd-workflow">Example 5: Full CI/CD Workflow</a></h3>
<p>Complete workflow for continuous debt monitoring:</p>
<pre><code class="language-bash">#!/bin/bash
# ci-debt-check.sh

set -e

BEFORE="before.json"
AFTER="after.json"
COMPARISON="comparison.json"

# Step 1: Analyze baseline (main branch)
echo "üìä Analyzing baseline..."
git checkout main
debtmap analyze --output "$BEFORE"

# Step 2: Analyze current branch
echo "üìä Analyzing current branch..."
git checkout -
debtmap analyze --output "$AFTER"

# Step 3: Run comparison
echo "üîç Running comparison..."
debtmap compare \
  --before "$BEFORE" \
  --after "$AFTER" \
  --output "$COMPARISON"

# Step 4: Extract metrics
TREND=$(jq -r '.summary.overall_debt_trend' "$COMPARISON")
REGRESSION_COUNT=$(jq '.regressions | length' "$COMPARISON")
IMPROVEMENT_COUNT=$(jq '.improvements | length' "$COMPARISON")
RESOLVED_COUNT=$(jq '.summary.resolved_count' "$COMPARISON")

echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "üìà Debt Comparison Results"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "Trend: $TREND"
echo "Regressions: $REGRESSION_COUNT"
echo "Improvements: $IMPROVEMENT_COUNT"
echo "Resolved: $RESOLVED_COUNT"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

# Step 5: Quality gate
if [ "$REGRESSION_COUNT" -gt 0 ]; then
  echo "‚ùå FAILED: Regression detected"
  jq '.regressions[]' "$COMPARISON"
  exit 1
fi

if [ "$TREND" = "Regressing" ]; then
  echo "‚ö†Ô∏è  WARNING: Overall debt is increasing"
  # Don't fail, just warn
fi

if [ "$RESOLVED_COUNT" -gt 0 ]; then
  echo "üéâ SUCCESS: $RESOLVED_COUNT debt items resolved!"
fi

echo "‚úÖ PASSED: No regressions detected"
</code></pre>
<h3 id="example-6-interpreting-comparison-results"><a class="header" href="#example-6-interpreting-comparison-results">Example 6: Interpreting Comparison Results</a></h3>
<p>Understanding the comparison output:</p>
<pre><code class="language-bash"># Run comparison
debtmap compare --before before.json --after after.json --output comparison.json

# Check debt trend
TREND=$(jq -r '.summary.overall_debt_trend' comparison.json)
REGRESSION_COUNT=$(jq '.regressions | length' comparison.json)
IMPROVEMENT_COUNT=$(jq '.improvements | length' comparison.json)

case "$TREND" in
  "Improving")
    echo "üéâ Success! Debt is decreasing"
    echo "Improvements: $IMPROVEMENT_COUNT"
    jq '.improvements[] | "\(.location): \(.improvement_type)"' comparison.json
    ;;
  "Stable")
    echo "‚û°Ô∏è  Stable - no significant debt change"
    echo "Improvements: $IMPROVEMENT_COUNT"
    echo "Regressions: $REGRESSION_COUNT"
    ;;
  "Regressing")
    echo "‚ùå Warning! Debt is increasing"
    echo "New critical items: $REGRESSION_COUNT"
    jq '.regressions[] | "\(.location): \(.score) (\(.debt_type))"' comparison.json
    ;;
esac

# Check if target improved (if target was specified)
if jq -e '.target_item' comparison.json &gt; /dev/null; then
  TARGET_STATUS=$(jq -r '.target_item.status' comparison.json)
  echo "Target Status: $TARGET_STATUS"
fi
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="understanding-debt-trends"><a class="header" href="#understanding-debt-trends">Understanding Debt Trends</a></h3>
<p><strong>Issue</strong>: Confused about what the debt trend means</p>
<p><strong>Solution</strong>: Check the <code>summary.overall_debt_trend</code> field in comparison output:</p>
<ul>
<li><code>Improving</code> - Total debt decreased by more than 5%</li>
<li><code>Stable</code> - Total debt changed by less than 5% (within normal variance)</li>
<li><code>Regressing</code> - Total debt increased by more than 5%</li>
</ul>
<p><strong>Check the trend</strong>:</p>
<pre><code class="language-bash">TREND=$(jq -r '.summary.overall_debt_trend' comparison.json)
DEBT_CHANGE=$(jq '.project_health.changes.debt_score_change_pct' comparison.json)
echo "Debt Trend: $TREND (${DEBT_CHANGE}% change)"
</code></pre>
<h3 id="no-improvements-detected"><a class="header" href="#no-improvements-detected">No Improvements Detected</a></h3>
<p><strong>Issue</strong>: Made changes but comparison shows no improvements</p>
<p><strong>Possible causes</strong>:</p>
<ol>
<li>Changes didn‚Äôt reduce debt scores by ‚â•30% (improvement threshold)</li>
<li>Refactored items had scores &lt;60.0 (not tracked as critical)</li>
<li>Changes were neutral (e.g., code moved but complexity unchanged)</li>
</ol>
<p><strong>Solution</strong>: Check the details:</p>
<pre><code class="language-bash"># Compare before/after project health
jq '.project_health.before' result.json
jq '.project_health.after' result.json

# Look for critical items in before analysis
jq '.items[] | select(.unified_score.final_score &gt;= 60.0)' before.json
</code></pre>
<h3 id="json-parsing-errors"><a class="header" href="#json-parsing-errors">JSON Parsing Errors</a></h3>
<p><strong>Problem</strong>: <code>Error parsing JSON file</code></p>
<p><strong>Solutions</strong>:</p>
<ol>
<li>Verify the file is valid JSON: <code>jq . before.json</code></li>
<li>Ensure the file is a debtmap analysis output</li>
<li>Check file permissions and path</li>
<li>Regenerate the analysis if corrupted</li>
</ol>
<h3 id="understanding-target-status-values"><a class="header" href="#understanding-target-status-values">Understanding Target Status Values</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Status</th><th>Meaning</th><th>Action Required</th></tr></thead><tbody>
<tr><td><code>Resolved</code></td><td>Item eliminated completely</td><td>‚úÖ Celebrate! Item no longer exists</td></tr>
<tr><td><code>Improved</code></td><td>Score reduced significantly</td><td>‚úÖ Good progress, verify metrics improved</td></tr>
<tr><td><code>Unchanged</code></td><td>No significant change</td><td>‚ö†Ô∏è Review approach, may need different strategy</td></tr>
<tr><td><code>Regressed</code></td><td>Item got worse</td><td>‚ùå Investigate and fix before merging</td></tr>
<tr><td><code>NotFoundBefore</code></td><td>Item didn‚Äôt exist before</td><td>‚ÑπÔ∏è New code, ensure quality is acceptable</td></tr>
<tr><td><code>NotFound</code></td><td>Item not found in either</td><td>‚ö†Ô∏è Check target location format</td></tr>
</tbody></table>
</div>
<h3 id="handling-missing-files"><a class="header" href="#handling-missing-files">Handling Missing Files</a></h3>
<p><strong>Problem</strong>: <code>No such file or directory</code></p>
<p><strong>Solutions</strong>:</p>
<pre><code class="language-bash"># Verify files exist
ls -la before.json after.json

# Check current directory
pwd

# Use absolute paths if needed
debtmap compare \
  --before /absolute/path/to/before.json \
  --after /absolute/path/to/after.json
</code></pre>
<h3 id="interpreting-edge-cases"><a class="header" href="#interpreting-edge-cases">Interpreting Edge Cases</a></h3>
<p><strong>All Items Resolved</strong>:</p>
<pre><code class="language-json">{
  "summary": {
    "resolved_count": 25,
    "new_critical_count": 0,
    "overall_debt_trend": "Improving"
  },
  "project_health": {
    "after": {
      "total_items": 0,
      "critical_items": 0
    }
  }
}
</code></pre>
<p>All debt items resolved - excellent work!</p>
<p><strong>New Project (Empty Before)</strong>:</p>
<pre><code class="language-json">{
  "summary": {
    "new_critical_count": 15,
    "resolved_count": 0,
    "overall_debt_trend": "Stable"
  },
  "project_health": {
    "before": {
      "total_items": 0
    }
  }
}
</code></pre>
<p>New project or first analysis - establish baseline for future comparisons.</p>
<p><strong>No Changes</strong>:</p>
<pre><code class="language-json">{
  "summary": {
    "overall_debt_trend": "Stable",
    "new_critical_count": 0,
    "resolved_count": 0
  },
  "improvements": [],
  "regressions": []
}
</code></pre>
<p>No changes detected - either no code changes or changes were neutral to debt.</p>
<h2 id="related-documentation"><a class="header" href="#related-documentation">Related Documentation</a></h2>
<ul>
<li><a href="validation.html">Validation Command</a> - Validate implementation plans match analysis</li>
<li><a href="prodigy-integration.html">Prodigy Integration</a> - Automated refactoring workflows</li>
<li><a href="output-formats.html">Output Formats</a> - Understanding analysis JSON structure</li>
<li><a href="scoring-strategies.html">Scoring Strategies</a> - How debt scores are calculated</li>
<li><a href="ci-cd.html">CI/CD Integration</a> - Advanced pipeline configurations</li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>The compare command provides validation for refactoring efforts:</p>
<p><strong>Current Capabilities:</strong></p>
<ul>
<li>‚úÖ Target location tracking with intelligent fuzzy matching</li>
<li>‚úÖ Detect regressions (new critical items with score ‚â• 60.0)</li>
<li>‚úÖ Track resolved items and improvements (‚â•30% score reduction)</li>
<li>‚úÖ Detailed per-item improvement metrics with before/after scores</li>
<li>‚úÖ Multiple output formats (JSON, Markdown, Terminal)</li>
<li>‚úÖ Implementation plan parsing for target extraction</li>
<li>‚úÖ Project-wide health metrics and debt trends</li>
<li>‚úÖ Automate quality gates in CI/CD pipelines</li>
</ul>
<p>Use the compare command regularly to maintain visibility into your codebase‚Äôs technical health and ensure continuous improvement. All features are fully implemented and ready for production use.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="analysis-guide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="analysis-guide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
