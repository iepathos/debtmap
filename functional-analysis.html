<!DOCTYPE HTML>
<html lang="en" class="rust sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Functional Composition Analysis - Debtmap Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="Comprehensive guide to Debtmap code complexity and technical debt analyzer">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "rust";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-6f6cd753.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-c7b19542.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Debtmap Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/iepathos/debtmap" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="functional-composition-analysis"><a class="header" href="#functional-composition-analysis">Functional Composition Analysis</a></h1>
<p>Debtmap provides deep AST-based analysis to detect and evaluate functional programming patterns in Rust code. This feature helps you understand how effectively your codebase uses functional composition patterns like iterator pipelines, identify opportunities for refactoring imperative code to functional style, and rewards pure, side-effect-free functions in complexity scoring.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Functional analysis examines your code at the AST level to detect:</p>
<ul>
<li><strong>Iterator pipelines</strong> - Chains like <code>.iter().map().filter().collect()</code></li>
<li><strong>Purity analysis</strong> - Functions with no mutable state or side effects</li>
<li><strong>Composition quality metrics</strong> - Overall functional programming quality scores</li>
<li><strong>Side effect classification</strong> - Categorization of Pure, Benign, and Impure side effects</li>
</ul>
<p>This analysis integrates with debtmap’s scoring system, providing score bonuses for high-quality functional code and reducing god object warnings for codebases with many small pure helper functions.</p>
<p><strong>Specification</strong>: This feature implements <a href="https://github.com/yourusername/debtmap/specs/111">Specification 111: AST-Based Functional Pattern Detection</a> with accuracy targets of precision ≥90%, recall ≥85%, F1 ≥0.87, and performance overhead &lt;10%.</p>
<h2 id="configuration-profiles"><a class="header" href="#configuration-profiles">Configuration Profiles</a></h2>
<p>Debtmap provides three pre-configured analysis profiles to match different codebases:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Profile</th><th>Use Case</th><th>Min Pipeline Depth</th><th>Max Closure Complexity</th><th>Purity Threshold</th><th>Quality Threshold</th></tr>
</thead>
<tbody>
<tr><td><strong>Strict</strong></td><td>Functional-first codebases</td><td>3</td><td>3</td><td>0.9</td><td>0.7</td></tr>
<tr><td><strong>Balanced</strong> (default)</td><td>Typical Rust projects</td><td>2</td><td>5</td><td>0.8</td><td>0.6</td></tr>
<tr><td><strong>Lenient</strong></td><td>Imperative-heavy legacy code</td><td>2</td><td>10</td><td>0.5</td><td>0.4</td></tr>
</tbody>
</table>
</div>
<h3 id="choosing-a-profile"><a class="header" href="#choosing-a-profile">Choosing a Profile</a></h3>
<p><strong>Use Strict</strong> when:</p>
<ul>
<li>Your codebase emphasizes functional programming patterns</li>
<li>You want to enforce high purity standards</li>
<li>You’re building a new project with functional-first principles</li>
<li>You want to detect even simple pipelines (3+ stages)</li>
</ul>
<p><strong>Use Balanced</strong> (default) when:</p>
<ul>
<li>You have a typical Rust codebase mixing functional and imperative styles</li>
<li>You want reasonable detection without being overly strict</li>
<li>You’re working on a mature project with mixed patterns</li>
<li>You want to reward functional patterns without penalizing pragmatic imperative code</li>
</ul>
<p><strong>Use Lenient</strong> when:</p>
<ul>
<li>You’re analyzing legacy code with heavy imperative patterns</li>
<li>You want to identify only the most obviously functional code</li>
<li>You’re migrating from an imperative codebase and want gradual improvement</li>
<li>You have complex closures that are still fundamentally functional</li>
</ul>
<h3 id="cli-usage"><a class="header" href="#cli-usage">CLI Usage</a></h3>
<p>Enable functional analysis with the <code>--ast-functional-analysis</code> flag and select a profile with <code>--functional-analysis-profile</code>:</p>
<pre><code class="language-bash"># Enable with balanced profile (default)
debtmap analyze . --ast-functional-analysis --functional-analysis-profile balanced

# Use strict profile for functional-first codebases
debtmap analyze . --ast-functional-analysis --functional-analysis-profile strict

# Use lenient profile for legacy code
debtmap analyze . --ast-functional-analysis --functional-analysis-profile lenient
</code></pre>
<p><strong>Note:</strong> The <code>--ast-functional-analysis</code> flag enables the feature, while <code>--functional-analysis-profile</code> selects the configuration profile (strict/balanced/lenient).</p>
<h2 id="pure-function-detection"><a class="header" href="#pure-function-detection">Pure Function Detection</a></h2>
<p>A function is considered pure when it:</p>
<ol>
<li>Returns same output for same input (deterministic)</li>
<li>Has no observable side effects</li>
<li>Doesn’t mutate external state</li>
<li>Doesn’t perform I/O</li>
</ol>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Pure function
fn add(a: i32, b: i32) -&gt; i32 {
    a + b
}

// Pure function with internal iteration
fn factorial(n: u32) -&gt; u32 {
    (1..=n).product()  // Pure despite internal iteration
}

// Not pure: I/O side effect
fn log_and_add(a: i32, b: i32) -&gt; i32 {
    println!("Adding {} and {}", a, b);  // Side effect!
    a + b
}

// Not pure: mutates external state
fn increment_counter(counter: &amp;mut i32) -&gt; i32 {
    *counter += 1;  // Side effect!
    *counter
}
<span class="boring">}</span></code></pre>
<h2 id="pipeline-detection"><a class="header" href="#pipeline-detection">Pipeline Detection</a></h2>
<p>Debtmap detects functional pipelines through deep AST analysis, identifying iterator chains and their transformations.</p>
<h3 id="pipeline-stages"><a class="header" href="#pipeline-stages">Pipeline Stages</a></h3>
<p>The analyzer recognizes these pipeline stage types:</p>
<h4 id="1-iterator-initialization"><a class="header" href="#1-iterator-initialization">1. Iterator Initialization</a></h4>
<p>Methods that start an iterator chain:</p>
<ul>
<li><code>.iter()</code> - Immutable iteration</li>
<li><code>.into_iter()</code> - Consuming iteration</li>
<li><code>.iter_mut()</code> - Mutable iteration</li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected iterator initialization
let results = collection.iter()
    .map(|x| x * 2)
    .collect();
<span class="boring">}</span></code></pre>
<h4 id="2-map-transformations"><a class="header" href="#2-map-transformations">2. Map Transformations</a></h4>
<p>Applies a transformation function to each element:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected Map stage
items.iter()
    .map(|x| x * 2)          // Simple closure (low complexity)
    .map(|x| {                // Complex closure (higher complexity)
        let doubled = x * 2;
        doubled + 1
    })
    .collect()
<span class="boring">}</span></code></pre>
<p>The analyzer tracks <strong>closure complexity</strong> for each map operation. Complex closures may indicate code smells and affect quality scoring based on your <code>max_closure_complexity</code> threshold.</p>
<h4 id="3-filter-predicates"><a class="header" href="#3-filter-predicates">3. Filter Predicates</a></h4>
<p>Selects elements based on a predicate:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected Filter stage
items.iter()
    .filter(|x| *x &gt; 0)      // Simple predicate
    .filter(|x| {             // Complex predicate
        x.is_positive() &amp;&amp; x &lt; 100
    })
    .collect()
<span class="boring">}</span></code></pre>
<h4 id="4-foldreduce-aggregation"><a class="header" href="#4-foldreduce-aggregation">4. Fold/Reduce Aggregation</a></h4>
<p>Combines elements into a single value:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected Fold stage
items.iter()
    .fold(0, |acc, x| acc + x)

// Or using reduce
items.iter()
    .reduce(|a, b| a + b)
<span class="boring">}</span></code></pre>
<h4 id="5-flatmap-transformations"><a class="header" href="#5-flatmap-transformations">5. FlatMap Transformations</a></h4>
<p>Maps and flattens nested structures:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected FlatMap stage
items.iter()
    .flat_map(|x| vec![x, x * 2])
    .collect()
<span class="boring">}</span></code></pre>
<h4 id="6-inspect-side-effect-aware"><a class="header" href="#6-inspect-side-effect-aware">6. Inspect (Side-Effect Aware)</a></h4>
<p>Performs side effects while passing through values:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected Inspect stage (affects purity scoring)
items.iter()
    .inspect(|x| println!("Processing: {}", x))
    .map(|x| x * 2)
    .collect()
<span class="boring">}</span></code></pre>
<h4 id="7-resultoption-chaining"><a class="header" href="#7-resultoption-chaining">7. Result/Option Chaining</a></h4>
<p>Specialized stages for error handling:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected AndThen stage
results.iter()
    .and_then(|x| try_process(x))
    .collect()

// Detected MapErr stage
results.iter()
    .map_err(|e| format!("Error: {}", e))
    .collect()
<span class="boring">}</span></code></pre>
<h3 id="terminal-operations"><a class="header" href="#terminal-operations">Terminal Operations</a></h3>
<p>Pipelines typically end with a terminal operation that consumes the iterator:</p>
<ul>
<li><strong><code>collect()</code></strong> - Gather elements into a collection</li>
<li><strong><code>sum()</code></strong> - Sum numeric values</li>
<li><strong><code>count()</code></strong> - Count elements</li>
<li><strong><code>any()</code></strong> - Check if any element matches</li>
<li><strong><code>all()</code></strong> - Check if all elements match</li>
<li><strong><code>find()</code></strong> - Find first matching element</li>
<li><strong><code>reduce()</code></strong> - Reduce to single value</li>
<li><strong><code>for_each()</code></strong> - Execute side effects for each element</li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Complete pipeline with terminal operation
let total: i32 = items.iter()
    .filter(|x| **x &gt; 0)
    .map(|x| x * 2)
    .sum();  // Terminal operation: sum
<span class="boring">}</span></code></pre>
<h3 id="nested-pipelines"><a class="header" href="#nested-pipelines">Nested Pipelines</a></h3>
<p>Debtmap detects pipelines nested within closures, indicating highly functional code patterns:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Nested pipeline detected
let results = outer_items.iter()
    .map(|item| {
        // Inner pipeline (nesting_level = 1)
        item.values.iter()
            .filter(|v| **v &gt; 0)
            .collect()
    })
    .collect();
<span class="boring">}</span></code></pre>
<p><strong>Nesting level</strong> tracking helps identify sophisticated functional composition patterns.</p>
<h3 id="parallel-pipelines"><a class="header" href="#parallel-pipelines">Parallel Pipelines</a></h3>
<p>Parallel iteration using Rayon is automatically detected:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use rayon::prelude::*;

// Detected as parallel pipeline (is_parallel = true)
let results: Vec&lt;_&gt; = items.par_iter()
    .filter(|x| **x &gt; 0)
    .map(|x| x * 2)
    .collect();
<span class="boring">}</span></code></pre>
<p>Parallel pipelines indicate high-performance functional patterns and receive positive quality scoring.</p>
<h3 id="builder-pattern-filtering"><a class="header" href="#builder-pattern-filtering">Builder Pattern Filtering</a></h3>
<p>To avoid false positives, debtmap distinguishes builder patterns from functional pipelines:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// This is a builder pattern, NOT counted as a functional pipeline
let config = ConfigBuilder::new()
    .with_host("localhost")
    .with_port(8080)
    .build();

// This IS a functional pipeline
let values = items.iter()
    .map(|x| x * 2)
    .collect();
<span class="boring">}</span></code></pre>
<p>Builder patterns are filtered out to ensure accurate functional composition metrics.</p>
<h2 id="purity-analysis"><a class="header" href="#purity-analysis">Purity Analysis</a></h2>
<p>Debtmap analyzes functions to determine their purity level - whether they have side effects and mutable state.</p>
<h3 id="purity-levels"><a class="header" href="#purity-levels">Purity Levels</a></h3>
<p>Functions are classified into three purity levels for god object weighting (defined in <code>src/organization/purity_analyzer.rs:19-26</code>):</p>
<blockquote>
<p><strong>Note:</strong> Debtmap has two purity analysis systems serving different purposes:</p>
<ol>
<li>
<p><strong>Three-level system</strong> (this section) - Used for god object scoring with weight multipliers:</p>
<ul>
<li>Defined in <code>src/organization/purity_analyzer.rs</code></li>
<li>Categories: Pure, ProbablyPure, Impure</li>
<li>Purpose: Dampen god object scores for pure functions via weight multipliers (0.3, 0.5, 1.0)</li>
</ul>
</li>
<li>
<p><strong>Four-level system</strong> - Used for detailed responsibility classification:</p>
<ul>
<li>Defined in <code>src/core/mod.rs:47-60</code> and <code>src/analysis/purity_analysis.rs:34-43</code></li>
<li>Categories: StrictlyPure, LocallyPure, ReadOnly, Impure</li>
<li>Purpose: Fine-grained analysis of function behavior and side effects</li>
<li>Used in responsibility analysis and technical debt assessment</li>
</ul>
</li>
</ol>
<p>The three-level system provides a simplified classification optimized for god object detection. The four-level system offers more granular distinctions (e.g., builder patterns with local mutations vs. read-only accessors).</p>
<p>This chapter focuses on the three-level system used for god object integration. For detailed responsibility classification, see <a href="./responsibility-analysis.html">Responsibility Analysis</a>.</p>
</blockquote>
<h4 id="pure-weight-03"><a class="header" href="#pure-weight-03">Pure (Weight 0.3)</a></h4>
<p>Guaranteed no side effects:</p>
<ul>
<li>No mutable parameters (<code>&amp;mut</code>, <code>mut self</code>)</li>
<li>No I/O operations</li>
<li>No global mutations</li>
<li>No <code>unsafe</code> blocks</li>
<li>Only immutable bindings</li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Pure function
fn calculate_total(items: &amp;[i32]) -&gt; i32 {
    items.iter().sum()
}

// Pure function with immutable bindings
fn process_value(x: i32) -&gt; i32 {
    let doubled = x * 2;  // Immutable binding
    let result = doubled + 10;
    result
}
<span class="boring">}</span></code></pre>
<h4 id="probably-pure-weight-05"><a class="header" href="#probably-pure-weight-05">Probably Pure (Weight 0.5)</a></h4>
<p>Likely no side effects:</p>
<ul>
<li>Static functions (<code>fn</code> items, not methods)</li>
<li>Associated functions (no <code>self</code>)</li>
<li>No obvious side effects detected</li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Probably pure - static function
fn transform(value: i32) -&gt; i32 {
    value * 2
}

// Probably pure - associated function
impl MyType {
    fn create_default() -&gt; Self {
        MyType { value: 0 }
    }
}
<span class="boring">}</span></code></pre>
<h4 id="impure-weight-10"><a class="header" href="#impure-weight-10">Impure (Weight 1.0)</a></h4>
<p>Has side effects:</p>
<ul>
<li>Uses mutable references (<code>&amp;mut</code>, <code>mut self</code>)</li>
<li>Performs I/O operations (<code>println!</code>, file I/O, network)</li>
<li>Uses <code>async</code> (potential side effects)</li>
<li>Mutates global state</li>
<li>Uses <code>unsafe</code></li>
</ul>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Impure - mutable reference
fn increment(value: &amp;mut i32) {
    *value += 1;
}

// Impure - I/O operation
fn log_value(value: i32) {
    println!("Value: {}", value);
}

// Impure - mutation
fn process_items(items: &amp;mut Vec&lt;i32&gt;) {
    items.push(42);
}
<span class="boring">}</span></code></pre>
<h3 id="purity-weight-multipliers"><a class="header" href="#purity-weight-multipliers">Purity Weight Multipliers</a></h3>
<p>Purity levels affect god object detection through weight multipliers (implemented in <code>src/organization/purity_analyzer.rs:29-39</code>). Pure functions contribute <strong>less</strong> to god object scores, rewarding codebases with many small pure helper functions:</p>
<ul>
<li><strong>Pure (0.3)</strong>: A pure function counts as 30% of a regular function in god object method count calculations</li>
<li><strong>Probably Pure (0.5)</strong>: Counts as 50%</li>
<li><strong>Impure (1.0)</strong>: Full weight</li>
</ul>
<p>The <code>purity_score</code> dampens god object scores via the <code>weight_multiplier</code> calculation. For example, pure functions with weight 0.3 count as only 30% of a regular function when calculating method counts for god object detection.</p>
<p><strong>Example</strong>: A module with 20 pure helper functions (20 × 0.3 = 6.0 effective) is less likely to trigger god object warnings than a module with 10 impure functions (10 × 1.0 = 10.0 effective).</p>
<h2 id="side-effect-detection"><a class="header" href="#side-effect-detection">Side Effect Detection</a></h2>
<h3 id="detected-side-effects"><a class="header" href="#detected-side-effects">Detected Side Effects</a></h3>
<p><strong>I/O Operations:</strong></p>
<ul>
<li>File reading/writing</li>
<li>Network calls</li>
<li>Console output</li>
<li>Database queries</li>
</ul>
<p><strong>State Mutation:</strong></p>
<ul>
<li>Mutable global variables</li>
<li>Shared mutable state</li>
<li>Reference mutations</li>
</ul>
<p><strong>Randomness:</strong></p>
<ul>
<li>Random number generation</li>
<li>Time-dependent behavior</li>
</ul>
<p><strong>System Interaction:</strong></p>
<ul>
<li>Environment variable access</li>
<li>System calls</li>
<li>Thread spawning</li>
</ul>
<h3 id="rust-specific-detection"><a class="header" href="#rust-specific-detection">Rust-Specific Detection</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Interior mutability detection
use std::cell::RefCell;

fn has_side_effect() {
    let data = RefCell::new(vec![]);
    data.borrow_mut().push(1);  // Detected as mutation
}

// Unsafe code detection
fn unsafe_side_effect() {
    unsafe {
        // Automatically flagged as potentially impure
    }
}
<span class="boring">}</span></code></pre>
<h3 id="side-effect-classification"><a class="header" href="#side-effect-classification">Side Effect Classification</a></h3>
<p>Side effects are categorized by severity:</p>
<h4 id="pure---no-side-effects"><a class="header" href="#pure---no-side-effects">Pure - No Side Effects</a></h4>
<p>No mutations, I/O, or global state changes:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Pure - only computation
fn fibonacci(n: u32) -&gt; u32 {
    match n {
        0 =&gt; 0,
        1 =&gt; 1,
        _ =&gt; fibonacci(n - 1) + fibonacci(n - 2),
    }
}
<span class="boring">}</span></code></pre>
<h4 id="benign---small-penalty"><a class="header" href="#benign---small-penalty">Benign - Small Penalty</a></h4>
<p>Only logging, tracing, or metrics:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use tracing::debug;

// Benign - logging side effect
fn process(value: i32) -&gt; i32 {
    debug!("Processing value: {}", value);
    value * 2
}
<span class="boring">}</span></code></pre>
<p>Benign side effects receive a <strong>small penalty</strong> in purity scoring. Logging and observability are recognized as practical necessities.</p>
<h4 id="impure---large-penalty"><a class="header" href="#impure---large-penalty">Impure - Large Penalty</a></h4>
<p>I/O, mutations, network operations:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Impure - file I/O
fn save_to_file(data: &amp;str) -&gt; std::io::Result&lt;()&gt; {
    std::fs::write("output.txt", data)
}

// Impure - network operation
async fn fetch_data(url: &amp;str) -&gt; Result&lt;String, reqwest::Error&gt; {
    reqwest::get(url).await?.text().await
}
<span class="boring">}</span></code></pre>
<p>Impure side effects receive a <strong>large penalty</strong> in purity scoring.</p>
<h3 id="purity-metrics"><a class="header" href="#purity-metrics">Purity Metrics</a></h3>
<p>For each function, debtmap calculates purity metrics through the functional composition analysis (<code>src/analysis/functional_composition.rs</code>). These metrics are computed by <code>analyze_composition()</code> and returned in <code>CompositionMetrics</code> and <code>PurityMetrics</code>:</p>
<ul>
<li><strong><code>has_mutable_state</code></strong> - Whether the function uses mutable bindings</li>
<li><strong><code>has_side_effects</code></strong> - Whether I/O or global mutations are detected</li>
<li><strong><code>immutability_ratio</code></strong> - Ratio of immutable to total bindings (0.0-1.0)</li>
<li><strong><code>is_const_fn</code></strong> - Whether declared as <code>const fn</code></li>
<li><strong><code>side_effect_kind</code></strong> - Classification: Pure, Benign, or Impure</li>
<li><strong><code>purity_score</code></strong> - Overall purity score (0.0 impure to 1.0 pure)</li>
</ul>
<h4 id="immutability-ratio"><a class="header" href="#immutability-ratio">Immutability Ratio</a></h4>
<p>The immutability ratio measures how much of a function’s local state is immutable:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn example() {
    let x = 10;         // Immutable
    let y = 20;         // Immutable
    let mut z = 30;     // Mutable
    z += 1;
    // immutability_ratio = 2/3 = 0.67
}
<span class="boring">}</span></code></pre>
<p>Higher immutability ratios contribute to better purity scores.</p>
<h2 id="composition-pattern-recognition"><a class="header" href="#composition-pattern-recognition">Composition Pattern Recognition</a></h2>
<h3 id="function-composition"><a class="header" href="#function-composition">Function Composition</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected composition pattern
fn process_data(input: String) -&gt; Result&lt;Output&gt; {
    input
        .parse()
        .map(validate)
        .and_then(transform)
        .map(normalize)
}
<span class="boring">}</span></code></pre>
<h3 id="higher-order-functions"><a class="header" href="#higher-order-functions">Higher-Order Functions</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected HOF pattern
fn apply_twice&lt;F&gt;(f: F, x: i32) -&gt; i32
where
    F: Fn(i32) -&gt; i32,
{
    f(f(x))
}
<span class="boring">}</span></code></pre>
<h3 id="mapfilterfold-chains"><a class="header" href="#mapfilterfold-chains">Map/Filter/Fold Chains</a></h3>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Detected functional pipeline
let result = items
    .iter()
    .filter(|x| x.is_valid())
    .map(|x| x.transform())
    .fold(0, |acc, x| acc + x);
<span class="boring">}</span></code></pre>
<h2 id="composition-quality-scoring"><a class="header" href="#composition-quality-scoring">Composition Quality Scoring</a></h2>
<p>Debtmap combines pipeline metrics and purity analysis into an overall <strong>composition quality score</strong> (0.0-1.0).</p>
<h3 id="scoring-factors"><a class="header" href="#scoring-factors">Scoring Factors</a></h3>
<p>The composition quality score considers:</p>
<ol>
<li><strong>Pipeline depth</strong> - Longer pipelines indicate more functional composition</li>
<li><strong>Purity score</strong> - Higher purity means better functional programming</li>
<li><strong>Immutability ratio</strong> - More immutable bindings improve the score</li>
<li><strong>Closure complexity</strong> - Simpler closures score better</li>
<li><strong>Parallel execution</strong> - Parallel pipelines receive bonuses</li>
<li><strong>Nested pipelines</strong> - Sophisticated composition patterns score higher</li>
</ol>
<h3 id="quality-thresholds"><a class="header" href="#quality-thresholds">Quality Thresholds</a></h3>
<p>Based on your configuration profile, functions with composition quality above the threshold receive <strong>score boosts</strong> in debtmap’s overall analysis:</p>
<ul>
<li><strong>Strict</strong>: Quality ≥ 0.7 required for boost</li>
<li><strong>Balanced</strong>: Quality ≥ 0.6 required for boost</li>
<li><strong>Lenient</strong>: Quality ≥ 0.4 required for boost</li>
</ul>
<p>High-quality functional code can offset complexity in other areas of your codebase.</p>
<h3 id="purity-scoring"><a class="header" href="#purity-scoring">Purity Scoring</a></h3>
<h4 id="distribution-analysis"><a class="header" href="#distribution-analysis">Distribution Analysis</a></h4>
<p>Debtmap calculates purity distribution:</p>
<ul>
<li><strong>Pure functions</strong>: 0 side effects detected</li>
<li><strong>Mostly pure</strong>: Minor side effects (e.g., logging)</li>
<li><strong>Impure</strong>: Multiple side effects</li>
<li><strong>Highly impure</strong>: Extensive state mutation and I/O</li>
</ul>
<h4 id="scoring-formula"><a class="header" href="#scoring-formula">Scoring Formula</a></h4>
<pre><code>Purity Score = (pure_functions / total_functions) × 100
Side Effect Density = total_side_effects / total_functions
</code></pre>
<h4 id="codebase-health-metrics"><a class="header" href="#codebase-health-metrics">Codebase Health Metrics</a></h4>
<pre><code>Target Purity Levels:
- Core business logic: 80%+ pure
- Utilities: 70%+ pure
- I/O layer: 20-30% pure (expected)
- Overall: 50%+ pure
</code></pre>
<h3 id="integration-with-risk-scoring"><a class="header" href="#integration-with-risk-scoring">Integration with Risk Scoring</a></h3>
<p>Functional composition quality integrates with debtmap’s risk scoring system and multi-signal aggregation framework:</p>
<ul>
<li><strong>High composition quality</strong> → Lower risk scores (functions with quality above threshold receive score boosts)</li>
<li><strong>Pure functions</strong> → Reduced god object penalties (via weight multipliers in <code>purity_analyzer.rs</code>)</li>
<li><strong>Deep pipelines</strong> → Bonus for functional patterns</li>
<li><strong>Impure side effects</strong> → Risk penalties applied</li>
</ul>
<p><strong>Multi-Signal Integration</strong>: Functional composition analysis is one of several signals aggregated in the unified analysis system (<code>src/builders/unified_analysis.rs</code> and <code>src/analysis/multi_signal_aggregation.rs</code>) alongside complexity metrics, god object detection, and risk assessment. This ensures that functional programming quality contributes to the comprehensive technical debt assessment across multiple dimensions.</p>
<p>This integration ensures that well-written functional code is properly rewarded in the overall technical debt assessment.</p>
<h2 id="practical-examples"><a class="header" href="#practical-examples">Practical Examples</a></h2>
<h3 id="example-1-detecting-imperative-vs-functional-code"><a class="header" href="#example-1-detecting-imperative-vs-functional-code">Example 1: Detecting Imperative vs Functional Code</a></h3>
<p><strong>Imperative style</strong> (lower composition quality):</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn process_items_imperative(items: Vec&lt;i32&gt;) -&gt; Vec&lt;i32&gt; {
    let mut results = Vec::new();
    for item in items {
        if item &gt; 0 {
            results.push(item * 2);
        }
    }
    results
}
// Detected: No pipelines, mutable state, lower purity score
<span class="boring">}</span></code></pre>
<p><strong>Functional style</strong> (higher composition quality):</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn process_items_functional(items: Vec&lt;i32&gt;) -&gt; Vec&lt;i32&gt; {
    items.iter()
        .filter(|x| **x &gt; 0)
        .map(|x| x * 2)
        .collect()
}
// Detected: Pipeline depth 3, pure function, high composition quality
<span class="boring">}</span></code></pre>
<h3 id="example-2-identifying-refactoring-opportunities"><a class="header" href="#example-2-identifying-refactoring-opportunities">Example 2: Identifying Refactoring Opportunities</a></h3>
<p>When debtmap detects low composition quality, it suggests refactoring:</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Original: Imperative with mutations
fn calculate_statistics(data: &amp;[f64]) -&gt; (f64, f64, f64) {
    let mut sum = 0.0;
    let mut min = f64::MAX;
    let mut max = f64::MIN;

    for &amp;value in data {
        sum += value;
        if value &lt; min { min = value; }
        if value &gt; max { max = value; }
    }

    (sum / data.len() as f64, min, max)
}

// Refactored: Functional style
fn calculate_statistics_functional(data: &amp;[f64]) -&gt; (f64, f64, f64) {
    let sum: f64 = data.iter().sum();
    let min = data.iter().min_by(|a, b| a.partial_cmp(b).unwrap()).unwrap();
    let max = data.iter().max_by(|a, b| a.partial_cmp(b).unwrap()).unwrap();

    (sum / data.len() as f64, *min, *max)
}
// Higher purity score, multiple pipelines detected
<span class="boring">}</span></code></pre>
<h3 id="example-3-using-profiles-for-different-codebases"><a class="header" href="#example-3-using-profiles-for-different-codebases">Example 3: Using Profiles for Different Codebases</a></h3>
<p><strong>Strict profile</strong> - Catches subtle functional patterns:</p>
<pre><code class="language-bash">$ debtmap analyze --ast-functional-analysis --functional-analysis-profile strict src/
# Detects pipelines with 3+ stages
# Requires purity ≥ 0.9 for "pure" classification
# Flags closures with complexity &gt; 3
</code></pre>
<p><strong>Balanced profile</strong> - Default for most projects:</p>
<pre><code class="language-bash">$ debtmap analyze --ast-functional-analysis --functional-analysis-profile balanced src/
# Detects pipelines with 2+ stages
# Requires purity ≥ 0.8 for "pure" classification
# Flags closures with complexity &gt; 5
</code></pre>
<p><strong>Lenient profile</strong> - For legacy code:</p>
<pre><code class="language-bash">$ debtmap analyze --ast-functional-analysis --functional-analysis-profile lenient src/
# Detects pipelines with 2+ stages
# Requires purity ≥ 0.5 for "pure" classification
# Flags closures with complexity &gt; 10
</code></pre>
<h3 id="example-4-interpreting-purity-scores"><a class="header" href="#example-4-interpreting-purity-scores">Example 4: Interpreting Purity Scores</a></h3>
<p><strong>Pure function</strong> (score: 1.0):</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn add(a: i32, b: i32) -&gt; i32 {
    a + b
}
// Purity: 1.0 (perfect)
// Immutability ratio: 1.0 (no bindings)
// Side effects: None
<span class="boring">}</span></code></pre>
<p><strong>Mostly pure</strong> (score: 0.8):</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn process(values: &amp;[i32]) -&gt; i32 {
    let doubled: Vec&lt;_&gt; = values.iter().map(|x| x * 2).collect();
    let sum: i32 = doubled.iter().sum();
    sum
}
// Purity: 0.8 (high)
// Immutability ratio: 1.0 (both bindings immutable)
// Side effects: None
// Pipelines: 2 detected
<span class="boring">}</span></code></pre>
<p><strong>Impure function</strong> (score: 0.2):</p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn log_and_process(values: &amp;mut Vec&lt;i32&gt;) {
    println!("Processing {} items", values.len());
    values.iter_mut().for_each(|x| *x *= 2);
}
// Purity: 0.2 (low)
// Immutability ratio: 0.0 (mutable parameter)
// Side effects: I/O (println), mutation
<span class="boring">}</span></code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="writing-functional-rust-code"><a class="header" href="#writing-functional-rust-code">Writing Functional Rust Code</a></h3>
<p>To achieve high composition quality scores:</p>
<ol>
<li>
<p><strong>Prefer iterator chains over manual loops</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Good
let evens: Vec&lt;_&gt; = items.iter().filter(|x| *x % 2 == 0).collect();

// Avoid
let mut evens = Vec::new();
for item in &amp;items {
    if item % 2 == 0 { evens.push(item); }
}
<span class="boring">}</span></code></pre>
</li>
<li>
<p><strong>Minimize mutable state</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Good
let result = calculate(input);

// Avoid
let mut result = 0;
result = calculate(input);
<span class="boring">}</span></code></pre>
</li>
<li>
<p><strong>Separate pure logic from side effects</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Good - pure computation
fn calculate_price(quantity: u32, unit_price: f64) -&gt; f64 {
    quantity as f64 * unit_price
}

// Good - I/O at the boundary
fn display_price(price: f64) {
    println!("Total: ${:.2}", price);
}
<span class="boring">}</span></code></pre>
</li>
<li>
<p><strong>Keep closures simple</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Good - simple closure
items.map(|x| x * 2)

// Consider extracting - complex closure
items.map(|x| {
    let temp = expensive_operation(x);
    transform(temp)
})

// Better
fn transform_item(x: i32) -&gt; i32 {
    let temp = expensive_operation(x);
    transform(temp)
}
items.map(transform_item)
<span class="boring">}</span></code></pre>
</li>
<li>
<p><strong>Use parallel iteration for CPU-intensive work</strong></p>
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use rayon::prelude::*;

let results: Vec&lt;_&gt; = large_dataset.par_iter()
    .map(|item| expensive_computation(item))
    .collect();
<span class="boring">}</span></code></pre>
</li>
</ol>
<h3 id="code-organization"><a class="header" href="#code-organization">Code Organization</a></h3>
<p><strong>Separate pure from impure:</strong></p>
<ul>
<li>Keep pure logic in core modules</li>
<li>Isolate I/O at boundaries</li>
<li>Use dependency injection for testability</li>
</ul>
<p><strong>Maximize purity in:</strong></p>
<ul>
<li>Business logic</li>
<li>Calculations and transformations</li>
<li>Validation functions</li>
<li>Data structure operations</li>
</ul>
<p><strong>Accept impurity in:</strong></p>
<ul>
<li>I/O layers</li>
<li>Logging and monitoring</li>
<li>External system integration</li>
<li>Application boundaries</li>
</ul>
<p><strong>Refactoring strategy:</strong></p>
<ol>
<li>Identify impure functions</li>
<li>Extract pure logic</li>
<li>Push side effects to boundaries</li>
<li>Test pure functions exhaustively</li>
</ol>
<h3 id="migration-guide"><a class="header" href="#migration-guide">Migration Guide</a></h3>
<p>To enable functional analysis on existing projects:</p>
<ol>
<li>
<p><strong>Start with lenient profile</strong> to understand current state:</p>
<pre><code class="language-bash">debtmap analyze --ast-functional-analysis --functional-analysis-profile lenient .
</code></pre>
</li>
<li>
<p><strong>Identify quick wins</strong> - functions that are almost functional:</p>
<ul>
<li>Look for loops that can become iterator chains</li>
<li>Find mutable variables that can be immutable</li>
<li>Spot side effects that can be extracted</li>
</ul>
</li>
<li>
<p><strong>Gradually refactor</strong> to functional patterns:</p>
<ul>
<li>Convert one function at a time</li>
<li>Run tests after each change</li>
<li>Measure improvements with debtmap</li>
</ul>
</li>
<li>
<p><strong>Tighten profile</strong> as codebase improves:</p>
<pre><code class="language-bash"># After refactoring
debtmap analyze --ast-functional-analysis --functional-analysis-profile balanced .

# For new modules
debtmap analyze --ast-functional-analysis --functional-analysis-profile strict src/new_module/
</code></pre>
</li>
<li>
<p><strong>Monitor composition quality trends</strong> over time</p>
</li>
</ol>
<h2 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h2>
<h3 id="code-quality-audit"><a class="header" href="#code-quality-audit">Code Quality Audit</a></h3>
<pre><code class="language-bash"># Assess functional purity
debtmap analyze . --ast-functional-analysis --functional-analysis-profile balanced --format markdown
</code></pre>
<h3 id="refactoring-targets"><a class="header" href="#refactoring-targets">Refactoring Targets</a></h3>
<pre><code class="language-bash"># Find impure functions in core logic
debtmap analyze src/core/ --ast-functional-analysis --functional-analysis-profile strict
</code></pre>
<h3 id="onboarding-guide"><a class="header" href="#onboarding-guide">Onboarding Guide</a></h3>
<pre><code class="language-bash"># Show functional patterns in codebase
debtmap analyze . --ast-functional-analysis --functional-analysis-profile balanced --summary
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="no-pipelines-detected-but-i-have-iterator-chains"><a class="header" href="#no-pipelines-detected-but-i-have-iterator-chains">“No pipelines detected” but I have iterator chains</a></h3>
<ul>
<li><strong>Check pipeline depth</strong>: Your chains may be too short for the profile
<ul>
<li>Strict requires 3+ stages</li>
<li>Balanced/Lenient require 2+ stages</li>
</ul>
</li>
<li><strong>Check for builder patterns</strong>: Method chaining for construction is filtered out</li>
<li><strong>Verify terminal operation</strong>: Ensure the chain ends with <code>collect()</code>, <code>sum()</code>, etc.</li>
</ul>
<h3 id="low-purity-score-for-seemingly-pure-functions"><a class="header" href="#low-purity-score-for-seemingly-pure-functions">“Low purity score” for seemingly pure functions</a></h3>
<ul>
<li><strong>Check for hidden side effects</strong>:
<ul>
<li><code>println!</code> or logging statements</li>
<li>Calls to impure helper functions</li>
<li><code>unsafe</code> blocks</li>
</ul>
</li>
<li><strong>Review immutability ratio</strong>: Unnecessary <code>mut</code> bindings lower the score</li>
<li><strong>Verify no I/O operations</strong>: File access, network calls affect purity</li>
</ul>
<h3 id="high-complexity-closures-flagged"><a class="header" href="#high-complexity-closures-flagged">“High complexity closures flagged”</a></h3>
<ul>
<li><strong>Extract complex closures</strong> into named functions:
<pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Instead of
items.map(|x| { /* 10 lines */ })

// Use
fn process_item(x: Item) -&gt; Result { /* 10 lines */ }
items.map(process_item)
<span class="boring">}</span></code></pre>
</li>
<li><strong>Adjust <code>max_closure_complexity</code></strong>: Consider lenient profile if needed</li>
<li><strong>Refactor closure logic</strong>: Break down complex operations</li>
</ul>
<h3 id="too-many-false-positives"><a class="header" href="#too-many-false-positives">Too Many False Positives</a></h3>
<p><strong>Issue:</strong> Pure functions flagged as impure</p>
<p><strong>Solution:</strong></p>
<ul>
<li>Use lenient profile</li>
<li>Suppress known patterns</li>
<li>Review detection criteria</li>
<li>Report false positives</li>
</ul>
<h3 id="missing-side-effects"><a class="header" href="#missing-side-effects">Missing Side Effects</a></h3>
<p><strong>Issue:</strong> Known impure functions not detected</p>
<p><strong>Solution:</strong></p>
<ul>
<li>Use strict profile</li>
<li>Check for exotic side effect patterns</li>
<li>Enable comprehensive analysis</li>
</ul>
<h3 id="performance-impact-concerns"><a class="header" href="#performance-impact-concerns">Performance impact concerns</a></h3>
<ul>
<li><strong>Spec 111 targets &lt;10% overhead</strong>: Performance impact should be minimal</li>
<li><strong>Disable for hot paths</strong>: Analyze functional patterns in separate runs if needed</li>
<li><strong>Use parallel processing</strong>: Leverage multi-core parallelism for faster analysis</li>
</ul>
<h2 id="related-chapters"><a class="header" href="#related-chapters">Related Chapters</a></h2>
<ul>
<li><a href="analysis-guide/index.html">Analysis Guide</a> - Understanding analysis types and methodologies</li>
<li><a href="analysis-guide/complexity-metrics.html">Complexity Metrics</a> - How functional patterns affect complexity metrics</li>
<li><a href="./scoring-strategies.html">Scoring Strategies</a> - Integration with overall technical debt scoring</li>
<li><a href="./god-object-detection.html">God Object Detection</a> - How purity weights reduce false positives</li>
<li><a href="./configuration.html">Configuration</a> - Advanced functional analysis configuration options</li>
</ul>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>Functional composition analysis helps you:</p>
<ul>
<li><strong>Identify functional patterns</strong> in your Rust codebase through AST-based pipeline detection</li>
<li><strong>Measure purity</strong> with side effect detection and immutability analysis</li>
<li><strong>Improve code quality</strong> by refactoring imperative code to functional style</li>
<li><strong>Get scoring benefits</strong> for high-quality functional programming patterns</li>
<li><strong>Choose appropriate profiles</strong> (strict/balanced/lenient) for different codebases</li>
</ul>
<p>Enable it with <code>--functional-analysis-profile</code> to start benefiting from functional programming insights in your technical debt analysis.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="error-handling-analysis.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="god-object-detection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="error-handling-analysis.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="god-object-detection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
