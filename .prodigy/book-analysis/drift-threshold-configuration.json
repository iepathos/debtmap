{
  "chapter_id": "threshold-configuration",
  "chapter_title": "Threshold Configuration",
  "chapter_file": "book/src/threshold-configuration.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Chapter is comprehensive and mostly accurate, but contains inconsistencies in multiplier values for Strict preset. The chapter provides excellent coverage of threshold presets, role multipliers, god object detection, and validation thresholds. All internal links are valid. Structure and examples are clear and helpful.",
  "issues": [
    {
      "type": "incorrect_information",
      "severity": "medium",
      "section": "Role-Based Multipliers - Table (Line 129)",
      "description": "Chapter shows Entry Points multiplier as 1.5x for all presets, but Strict preset actually uses 1.2x",
      "current_content": "| Entry Points | 1.5x | More lenient | `main()`, HTTP handlers, CLI commands |",
      "should_be": "Entry Points multiplier varies by preset: Strict=1.2x, Balanced=1.5x, Lenient=2.0x",
      "fix_suggestion": "Update table to show preset-specific multipliers:\n- Entry Points: Strict=1.2x, Balanced=1.5x, Lenient=2.0x\n- Keep note that multipliers vary by preset similar to utility/test functions",
      "source_reference": "src/complexity/threshold_manager.rs:129 (Strict), line 142 (Lenient)"
    },
    {
      "type": "incorrect_information",
      "severity": "medium",
      "section": "Preset Comparison Table and Detailed Examples (Lines 143-163)",
      "description": "Chapter consistently shows entry_point_multiplier as 1.5x in all examples for balanced preset, but this value varies: Strict=1.2x, Balanced=1.5x, Lenient=2.0x. The comparison table on line 157 shows entry point with multiplier 1.5x but this is only correct for balanced preset.",
      "current_content": "**Balanced Preset Entry Point (multiplier = 1.5x):**\n- Cyclomatic threshold: 7.5 (5 × 1.5)\n- Cognitive threshold: 15 (10 × 1.5)\n- Total threshold: 12 (8 × 1.5)\n- Length threshold: 30 lines (20 × 1.5)",
      "should_be": "Strict uses 1.2x, Balanced uses 1.5x, Lenient uses 2.0x for entry points",
      "fix_suggestion": "1. Update line 19-27 preset comparison table to show entry_point_multiplier row\n2. Update examples to clarify that 1.5x is specific to Balanced preset\n3. Add note that entry_point_multiplier varies by preset (like utility and test multipliers)",
      "source_reference": "src/complexity/threshold_manager.rs:129, 142 (from_preset implementation)"
    },
    {
      "type": "incorrect_information",
      "severity": "high",
      "section": "Preset Comparison Table (Line 30) - Test Function Multiplier",
      "description": "Documentation shows Test Function Multiplier as 3.0x for Strict preset in the table, but actual implementation uses 1.5x",
      "current_content": "Test Function Multiplier | 3.0x | 2.0x | 3.0x",
      "should_be": "Test Function Multiplier | 1.5x | 2.0x | 3.0x",
      "fix_suggestion": "Update line 30 in the preset comparison table to show Strict preset uses 1.5x for test functions, not 3.0x. The strict preset intentionally uses a lower multiplier (1.5x) for test functions to maintain quality standards even in tests.",
      "source_reference": "src/complexity/threshold_manager.rs:132 and line 232 (test_function_multiplier: 1.5 for strict preset)"
    },
    {
      "type": "incorrect_information",
      "severity": "high",
      "section": "Role-Based Multipliers explanation (Line 142)",
      "description": "Text claims 'Test Functions: Strict=3.0x' but implementation shows 1.5x for strict preset",
      "current_content": "**Test Functions**: Strict=3.0x, Balanced=2.0x, Lenient=3.0x",
      "should_be": "**Test Functions**: Strict=1.5x, Balanced=2.0x, Lenient=3.0x",
      "fix_suggestion": "Correct line 142 to reflect actual implementation. The strict preset uses 1.5x (not 3.0x) which makes sense for a strict quality standard - it enforces quality even in test code.",
      "source_reference": "src/complexity/threshold_manager.rs:132"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Preset Comparison Table (Lines 19-27)",
      "description": "The preset comparison table doesn't show the entry_point_multiplier, utility_multiplier, and test_function_multiplier values which vary by preset",
      "should_add": "Add rows to the preset comparison table:\n- Entry Point Multiplier: Strict=1.2x, Balanced=1.5x, Lenient=2.0x\n- Utility Multiplier: Strict=0.6x, Balanced=0.8x, Lenient=1.0x\n- Test Function Multiplier: Strict=1.5x, Balanced=2.0x, Lenient=3.0x (NOTE: Strict is 1.5x, not 3.0x as currently documented)",
      "fix_suggestion": "Expand the preset comparison table to include all three varying multipliers, showing that they're not uniform across presets. CRITICAL: Ensure test_function_multiplier shows 1.5x for strict (not 3.0x).",
      "source_reference": "src/complexity/threshold_manager.rs:120-148"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Configuration File (Lines 214-233)",
      "description": "Chapter shows complexity_thresholds section but doesn't document that ComplexityThresholds has validation to ensure all values are positive (non-zero)",
      "should_add": "Add note that all threshold values must be positive (> 0). Zero or negative values will cause validation errors and Debtmap will use defaults instead.",
      "fix_suggestion": "After line 233, add a note explaining threshold validation rules (non-zero, positive values required)",
      "source_reference": "Book lines 109-121 mention validation but configuration section could reinforce this"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "CLI Threshold Flags (Lines 190-198)",
      "description": "Chapter mentions --threshold-complexity as 'legacy flag' but doesn't fully explain what it does or how it differs from the preset system",
      "current_content": "# Override cyclomatic complexity threshold (legacy flag, default: 10)\ndebtmap analyze . --threshold-complexity 15",
      "should_be": "Explain that --threshold-complexity sets a single cyclomatic complexity threshold, while --threshold-preset configures all complexity metrics and role multipliers comprehensively",
      "fix_suggestion": "Add clarification that legacy flags only set individual thresholds and don't provide the comprehensive configuration that presets offer",
      "source_reference": "src/cli.rs:threshold_complexity vs threshold_preset"
    },
    {
      "type": "unclear_content",
      "severity": "low",
      "section": "Complete Example Configuration (Lines 237-279)",
      "description": "The [thresholds] section in the complete example shows 'complexity' and 'cognitive' fields, but these appear to be legacy settings. The chapter should clarify the relationship between [thresholds] and [complexity_thresholds] sections",
      "current_content": "[thresholds]\ncomplexity = 15\ncognitive = 20",
      "should_be": "Clarify that [complexity_thresholds] is the modern section with full control, while [thresholds] may contain legacy settings",
      "fix_suggestion": "Add a note explaining the difference between [thresholds] (legacy/simple) and [complexity_thresholds] (modern/comprehensive) configuration sections",
      "source_reference": "src/config/thresholds.rs and src/complexity/threshold_manager.rs"
    }
  ],
  "positive_aspects": [
    "Excellent comprehensive coverage of all threshold configuration options",
    "Clear explanation of the conjunction (AND) logic for flagging functions (lines 101-107)",
    "Very helpful preset comparison table with specific values",
    "Good explanation of role-based multipliers and their purpose",
    "Comprehensive god object thresholds documentation with language-specific values",
    "Clear validation thresholds section for CI/CD integration",
    "Excellent decision tree for choosing presets (lines 537-560)",
    "Practical examples throughout the chapter",
    "Good troubleshooting section",
    "Accurate validation threshold explanation including scale-independent metrics",
    "Correct explanation of threshold validation rules (lines 109-121)"
  ],
  "improvement_suggestions": [
    "Add entry_point_multiplier values to the main preset comparison table",
    "Clarify that entry_point_multiplier varies by preset (not fixed at 1.5x)",
    "Consider adding a dedicated section on how multipliers are applied (formula: base_threshold × role_multiplier)",
    "Add more examples showing how different presets affect the same function",
    "Consider adding a section on the secondary role multipliers (PureLogic, Orchestrator, IOWrapper, etc.) from src/config/scoring.rs",
    "Clarify relationship between legacy [thresholds] section and modern [complexity_thresholds] section in .debtmap.toml",
    "Add explanation of role coverage weights (RoleCoverageWeights from src/config/scoring.rs)",
    "Consider documenting the file size thresholds for different code categories (business_logic, test_code, etc.)",
    "Add note about DEBTMAP_THRESHOLD_PRESET environment variable",
    "Consider adding a quick reference table mapping CLI flags to TOML sections"
  ],
  "metadata": {
    "analyzed_at": "2025-11-13T07:20:00Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Threshold presets (strict, balanced, lenient)",
      "Custom threshold configuration",
      "Language-specific thresholds (god objects)",
      "Cyclomatic complexity thresholds",
      "Cognitive complexity thresholds",
      "God object thresholds",
      "Validation thresholds",
      "Role-based multipliers",
      "CLI flags",
      "Configuration file structure",
      "Tuning guidelines"
    ],
    "validation_focus": "Check that all threshold presets and configuration options are documented",
    "internal_links_validated": true,
    "broken_links": [],
    "internal_links_checked": [
      "getting-started.md (valid)",
      "cli-reference.md (valid)",
      "configuration.md (valid)",
      "scoring-strategies.md (valid)",
      "god-object-detection.md (valid)"
    ],
    "source_files_examined": [
      "src/complexity/threshold_manager.rs (lines 120-148: preset definitions)",
      "src/config/thresholds.rs (validation thresholds)",
      "src/organization/god_object_analysis.rs (god object thresholds)",
      "src/config/scoring.rs (role multipliers and weights)",
      "src/cli.rs (CLI argument definitions)",
      "src/config/loader.rs (configuration loading)",
      "book/src/threshold-configuration.md (chapter content)"
    ]
  }
}
