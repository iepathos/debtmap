{
  "chapter_id": "cache-management",
  "chapter_title": "Cache Management",
  "chapter_file": "book/src/cache-management.md",
  "drift_detected": true,
  "severity": "critical",
  "quality_assessment": "Chapter is completely missing despite extensive cache functionality in codebase. Users have no documentation for critical performance and disk space management features.",
  "issues": [
    {
      "type": "missing_content",
      "severity": "critical",
      "section": "Entire Chapter",
      "description": "Chapter file does not exist, but codebase has comprehensive cache management system",
      "should_add": "Create complete chapter documenting cache location, configuration, pruning strategies, environment variables, and troubleshooting",
      "fix_suggestion": "Create book/src/cache-management.md with sections covering all cache features documented in features.json",
      "source_reference": "src/cache/cache_location.rs, src/cache/auto_pruner.rs, src/cache/pruning/decision.rs"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Cache Location Configuration",
      "description": "No documentation for cache location priority order and platform-specific defaults",
      "should_add": "Document cache location resolution: DEBTMAP_CACHE_DIR → XDG_CACHE_HOME/debtmap → ~/Library/Caches/debtmap (macOS) → ~/.cache/debtmap (Linux) → %LOCALAPPDATA%/debtmap (Windows)",
      "fix_suggestion": "Add section 'Cache Location and Configuration' explaining location priority, CacheStrategy enum (Shared vs Custom), and project identification via git remote URL or path hash",
      "source_reference": "src/cache/cache_location.rs:24-89"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Environment Variables",
      "description": "No documentation for cache-related environment variables",
      "should_add": "Document all DEBTMAP_CACHE_* environment variables: DEBTMAP_CACHE_DIR, DEBTMAP_CACHE_AUTO_PRUNE, DEBTMAP_CACHE_MAX_SIZE, DEBTMAP_CACHE_MAX_AGE_DAYS, DEBTMAP_CACHE_MAX_ENTRIES, DEBTMAP_CACHE_PRUNE_PERCENTAGE, DEBTMAP_CACHE_STRATEGY, DEBTMAP_CACHE_SYNC_PRUNE, DEBTMAP_CACHE_SCOPE",
      "fix_suggestion": "Add section 'Environment Variables' with table showing variable name, description, default value, and example usage for each cache configuration option",
      "source_reference": "src/cache/auto_pruner.rs:26-213, src/cache/cache_location.rs:26"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Pruning Strategies",
      "description": "No documentation for the four cache pruning strategies",
      "should_add": "Document pruning strategies: LRU (removes least recently accessed), LFU (removes least frequently used), FIFO (removes oldest by creation time), AgeBasedOnly (removes only entries older than max age)",
      "fix_suggestion": "Add section 'Automatic Pruning Strategies' explaining each strategy, when to use each, and how to configure via DEBTMAP_CACHE_STRATEGY environment variable",
      "source_reference": "src/cache/auto_pruner.rs:9-20, 251-308"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Cache CLI Options",
      "description": "No documentation for cache-related CLI flags",
      "should_add": "Document CLI options: --no-cache (disable caching), --clear-cache (clear before run), --force-cache-rebuild (rebuild cache), --cache-stats (show statistics), --migrate-cache (migrate to shared location), --cache-location (specify custom location)",
      "fix_suggestion": "Add section 'Command Line Options' documenting each cache CLI flag with examples of usage",
      "source_reference": "src/cli.rs:146-168"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Default Configuration",
      "description": "No documentation for default cache settings",
      "should_add": "Document defaults: max_size_bytes = 1GB, max_age_days = 30, max_entries = 10000, prune_percentage = 0.25 (25%), strategy = LRU, auto_prune_enabled = true",
      "fix_suggestion": "Add section 'Default Configuration' showing all default values and explaining when auto-pruning triggers",
      "source_reference": "src/cache/auto_pruner.rs:93-103"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Cache Structure",
      "description": "No documentation for cache directory structure and subdirectories",
      "should_add": "Document cache subdirectories created: call_graphs/, analysis/, metadata/, temp/, file_metrics/",
      "fix_suggestion": "Add section 'Cache Directory Structure' explaining the purpose of each subdirectory and what data is stored where",
      "source_reference": "src/cache/cache_location.rs:176-196"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Performance Impact",
      "description": "No documentation explaining cache performance benefits",
      "should_add": "Explain that caching speeds up repeated analyses by storing parsed ASTs, call graphs, and analysis results; particularly beneficial for large codebases and CI/CD pipelines",
      "fix_suggestion": "Add section 'Performance Optimization' explaining cache benefits, when cache hits occur, and best practices for CI environments",
      "source_reference": ".prodigy/book-analysis/features.json:602-629"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Troubleshooting",
      "description": "No troubleshooting guidance for cache issues",
      "should_add": "Document common issues: cache taking too much space (configure DEBTMAP_CACHE_MAX_SIZE or use --clear-cache), stale cache causing incorrect results (use --force-cache-rebuild), permission errors (check DEBTMAP_CACHE_DIR permissions)",
      "fix_suggestion": "Add section 'Troubleshooting Cache Issues' with common problems and solutions, including how to inspect cache with --cache-stats",
      "source_reference": ".prodigy/book-analysis/features.json:718-742"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Project Identification",
      "description": "No documentation explaining how debtmap identifies projects for cache isolation",
      "should_add": "Explain that projects are identified by git remote URL hash (first choice) or absolute path hash (fallback), ensuring cache isolation between different projects",
      "fix_suggestion": "Add technical note explaining project ID generation using SHA256 hash (first 16 chars) for cache key uniqueness",
      "source_reference": "src/cache/cache_location.rs:91-143"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Background vs Synchronous Pruning",
      "description": "No documentation for pruning execution modes",
      "should_add": "Explain that pruning can be synchronous (blocks during cleanup, used in tests) or background (non-blocking, default in production), controlled by DEBTMAP_CACHE_SYNC_PRUNE",
      "fix_suggestion": "Add technical note explaining BackgroundPruner spawns threads for non-blocking cleanup, useful for CI pipelines where analysis shouldn't wait for pruning",
      "source_reference": "src/cache/auto_pruner.rs:516-617"
    }
  ],
  "positive_aspects": [],
  "improvement_suggestions": [
    "Create chapter with clear structure: Introduction → Location Configuration → Environment Variables → Pruning Strategies → CLI Options → Performance Tips → Troubleshooting",
    "Include practical examples for each environment variable configuration",
    "Add decision tree for choosing pruning strategy based on use case",
    "Include examples of cache statistics output from --cache-stats",
    "Add warnings about disk space and age limits for CI environments",
    "Link to Performance Tuning section if it exists in the book",
    "Include examples of cache migration from local to shared location"
  ],
  "metadata": {
    "analyzed_at": "2025-10-20",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [],
    "validation_focus": "Check that cache configuration options, pruning strategies, and environment variables are documented",
    "chapter_exists": false,
    "implementation_files": [
      "src/cache/cache_location.rs",
      "src/cache/auto_pruner.rs",
      "src/cache/pruning/decision.rs",
      "src/cache/shared_cache/mod.rs",
      "src/cache/index_manager.rs",
      "src/cli.rs (lines 142-168)"
    ]
  }
}
