{
  "chapter_id": "multi-pass-analysis",
  "chapter_title": "Multi-Pass Analysis",
  "chapter_file": "book/src/multi-pass-analysis.md",
  "drift_detected": true,
  "severity": "low",
  "quality_assessment": "Chapter is comprehensive, well-written, and highly accurate. Excellent conceptual coverage with detailed examples. Most content aligns perfectly with implementation. Only minor clarifications needed around API details and internal implementation notes. Overall quality is very high.",
  "issues": [
    {
      "type": "correct_content",
      "severity": "none",
      "section": "Configuration Options (line 582)",
      "description": "Chapter correctly shows all OutputFormat variants in comment",
      "current_content": "output_format: OutputFormat::Json, // Also available: Yaml, Markdown, Html, Text",
      "validation": "Verified against src/analysis/diagnostics/mod.rs:122-129 - all variants match",
      "fix_suggestion": "No fix needed - documentation is accurate",
      "source_reference": "src/analysis/diagnostics/mod.rs:122-129"
    },
    {
      "type": "correct_content",
      "severity": "none",
      "section": "CLI Usage (line 96)",
      "description": "Chapter correctly documents that --attribution requires --multi-pass",
      "current_content": "> **Note**: The `--attribution` flag requires `--multi-pass` to be enabled, as attribution depends on comparing raw and normalized analyses.",
      "validation": "Verified against implementation - chapter correctly documents the dependency",
      "fix_suggestion": "No fix needed - documentation is accurate",
      "source_reference": "src/cli.rs:192-198"
    },
    {
      "type": "correct_content",
      "severity": "none",
      "section": "Comparative Analysis (line 484)",
      "description": "Chapter correctly explains compare_complexity as standalone convenience function",
      "current_content": "The `compare_complexity` function is a standalone convenience function that performs complete multi-pass analysis on both code versions and returns the computed differences",
      "validation": "Verified - chapter correctly notes this is a standalone function that performs analysis internally",
      "fix_suggestion": "No fix needed - documentation accurately describes the function",
      "source_reference": "src/analysis/multi_pass.rs:532-541"
    },
    {
      "type": "correct_content",
      "severity": "none",
      "section": "Configuration Options (line 594)",
      "description": "Chapter correctly shows both CLI and programmatic usage for detail_level",
      "current_content": "| `detail_level` | `DetailLevel` | `Standard` | Output detail: Summary, Standard, Comprehensive, Debug (CLI uses lowercase: `--detail-level standard`) |",
      "validation": "Verified - chapter correctly documents both CLI lowercase and enum PascalCase variants",
      "fix_suggestion": "No fix needed - documentation clearly explains the syntax difference",
      "source_reference": "src/cli.rs:200-202, src/analysis/diagnostics/mod.rs:91-98"
    },
    {
      "type": "correct_content",
      "severity": "none",
      "section": "ComparativeAnalysis struct (line 528)",
      "description": "Chapter correctly shows ComparativeAnalysis struct with only change metrics",
      "current_content": "pub struct ComparativeAnalysis {\n    pub complexity_change: i32,        // Negative = improvement\n    pub cognitive_change: i32,         // Negative = improvement\n    pub formatting_impact_change: f32, // Negative = less formatting noise\n    pub improvements: Vec<String>,\n    pub regressions: Vec<String>,\n}",
      "validation": "Verified - matches implementation exactly at src/analysis/multi_pass.rs:544-551",
      "fix_suggestion": "No fix needed - struct definition is accurate",
      "source_reference": "src/analysis/multi_pass.rs:544-551"
    },
    {
      "type": "correct_content",
      "severity": "none",
      "section": "Performance Considerations (line 468)",
      "description": "Chapter correctly notes that --jobs is a general debtmap flag",
      "current_content": "# Parallel analysis amortizes overhead across cores\n# Note: --jobs is a general debtmap flag controlling parallelism for all analysis\ndebtmap analyze . --multi-pass --jobs 8",
      "validation": "Verified - chapter explicitly clarifies this is not multi-pass specific",
      "fix_suggestion": "No fix needed - documentation is clear and accurate",
      "source_reference": "src/cli.rs:161-162, 395-398"
    },
    {
      "type": "correct_content",
      "severity": "none",
      "section": "Attribution Engine (line 67)",
      "description": "Chapter correctly notes that pattern complexity is part of standard multi-pass analysis",
      "current_content": "> **Note**: Pattern complexity analysis is part of the standard multi-pass analysis. No additional configuration is required to enable pattern detection.",
      "validation": "Verified - pattern detection is automatically enabled in multi-pass analysis via PatternTracker",
      "fix_suggestion": "No fix needed - documentation accurately reflects implementation",
      "source_reference": "src/analysis/attribution/mod.rs:8, 25, 35"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Performance Metrics - Memory Tracking",
      "description": "Chapter shows precise memory values but implementation uses simplified estimation",
      "current_content": "Memory used: 12.3 MB",
      "should_be": "Add note that memory usage is estimated based on thread count, not precise heap measurement",
      "fix_suggestion": "Add disclaimer that memory metrics are estimates: 'Note: Memory usage values are estimates based on parallelism level, not precise heap measurements'",
      "source_reference": "src/analysis/multi_pass.rs:111-119"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Comparative Analysis - Note about access to full results",
      "description": "Chapter mentions compare_complexity returns only changes, but could better emphasize no access to full before/after results",
      "current_content": "> **Note**: The `compare_complexity` function performs both analyses internally and returns only the change metrics. To access the full before/after results, perform separate analyses using `MultiPassAnalyzer`.",
      "should_add": "This is actually already documented correctly on line 537",
      "fix_suggestion": "No fix needed - chapter already has the note explaining this limitation",
      "source_reference": "src/analysis/multi_pass.rs:532-541"
    }
  ],
  "positive_aspects": [
    "Excellent visual diagram of two-pass analysis process",
    "Comprehensive examples with realistic Rust code",
    "Clear explanation of logical vs formatting complexity",
    "Detailed sample output showing attribution breakdown",
    "Good coverage of performance overhead and optimization tips",
    "Well-structured progression from concepts to usage to implementation",
    "Helpful comparative analysis examples",
    "Clear explanation of insight types and recommendations",
    "Good coverage of when to use multi-pass vs standard analysis",
    "Spec 84 future enhancement clearly documented"
  ],
  "improvement_suggestions": [
    "Add disclaimer that memory usage metrics are estimates, not precise measurements",
    "Consider adding troubleshooting section for common multi-pass issues (e.g., high overhead, performance tuning)",
    "Add example of complete multi-pass JSON output structure for tool integration",
    "Consider adding more detail on how normalization affects different code patterns",
    "Add guidance on interpreting pattern confidence scores in practice",
    "Consider adding section on CI/CD integration best practices for multi-pass analysis",
    "Add cross-references to related chapters (pattern detection, scoring strategies)",
    "Consider adding performance comparison table across different codebase sizes"
  ],
  "metadata": {
    "analyzed_at": "2025-11-06",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Multi-pass analysis overview",
      "Complexity attribution (logical, formatting, pattern)",
      "Attribution display options and detail levels",
      "Configuration and usage (CLI and programmatic)",
      "Performance considerations and overhead monitoring",
      "Comparative analysis",
      "Insights and recommendations generation",
      "Future enhancements (Spec 84)"
    ],
    "validation_focus": "Check that multi-pass analysis and attribution features are documented",
    "code_references_verified": [
      "src/analysis/multi_pass.rs:1-674",
      "src/analysis/attribution/mod.rs:1-100",
      "src/analysis/diagnostics/mod.rs:1-150",
      "src/cli.rs:192-202"
    ],
    "verified_features": [
      "MultiPassAnalyzer and MultiPassOptions",
      "ComplexityAttribution with logical/formatting/pattern breakdown",
      "DetailLevel variants (Summary, Standard, Comprehensive, Debug)",
      "OutputFormat variants (Json, Yaml, Markdown, Html, Text)",
      "ComparativeAnalysis structure and compare_complexity function",
      "Performance metrics tracking and overhead warnings",
      "Attribution engine with pattern tracking",
      "CLI flags: --multi-pass, --attribution, --detail-level, --jobs"
    ],
    "accuracy_assessment": "Very high - chapter accurately reflects implementation with only minor clarifications needed"
  }
}
