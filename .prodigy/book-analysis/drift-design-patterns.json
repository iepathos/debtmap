{
  "item_type": "chapter",
  "chapter_id": "design-patterns",
  "chapter_title": "Design Pattern Detection",
  "chapter_file": "book/src/design-patterns.md",
  "drift_detected": true,
  "severity": "high",
  "quality_assessment": "Chapter is fundamentally accurate about pattern detection implementation but contains critical misleading information about configuration system and custom rules. The 7 user-facing patterns are correctly documented with accurate examples. However, extensive documentation of non-functional configuration features and custom rules creates false expectations. The chapter correctly explains Builder/Visitor as internal-only patterns. Additionally, there is a broken internal link that needs to be fixed.",
  "issues": [
    {
      "type": "broken_links",
      "severity": "medium",
      "section": "Cross-References",
      "description": "Found 1 broken internal link in the See Also section",
      "broken_links": [
        {
          "link_text": "Complexity Analysis",
          "target_path": "./complexity-metrics.md",
          "expected_resolved_path": "book/src/complexity-metrics.md",
          "current_file": "book/src/design-patterns.md",
          "line": 694,
          "suggested_fix": "File does not exist. Similar file found: book/src/boilerplate-vs-complexity.md. The link may need to be updated to point to an existing complexity documentation file or the referenced file needs to be created."
        }
      ],
      "fix_suggestion": "Update the link at line 694 to point to an existing file. Either create complexity-metrics.md or update the link to reference an existing complexity documentation file like boilerplate-vs-complexity.md",
      "source_reference": "book/src/design-patterns.md:694"
    },
    {
      "type": "incorrect_information",
      "severity": "critical",
      "section": "Configuration File (lines 542-589)",
      "description": "Chapter extensively documents .debtmap.toml pattern configuration that is NOT actually loaded or used by pattern detectors",
      "current_content": "Configure pattern detection in `.debtmap.toml`:\n\n```toml\n[patterns]\nenabled = true\nconfidence_threshold = 0.7\n\n[patterns.observer]\ninterface_markers = [\"ABC\", \"Protocol\", \"Interface\"]\nregistration_methods = [\"add_observer\", \"register\", \"subscribe\"]\nmethod_prefixes = [\"on_\", \"handle_\", \"notify_\"]\n```",
      "reality": "PatternConfig exists and can parse TOML, but PatternDetector::new() creates all recognizers with hardcoded defaults. Configuration is not passed to recognizers. Users cannot customize pattern detection via .debtmap.toml.",
      "fix_suggestion": "Either:\n1. Remove entire configuration section (lines 542-589) and note patterns use hardcoded defaults\n2. Add prominent warning: 'Configuration system exists but is not yet functional. Pattern detectors use hardcoded defaults.'\n3. Mark as 'Planned Feature - Not Implemented'",
      "source_reference": "src/analysis/patterns/mod.rs:82-96 (PatternDetector::new creates recognizers without passing config), src/analysis/patterns/config.rs:PatternConfig (exists but unused)"
    },
    {
      "type": "incorrect_information",
      "severity": "critical",
      "section": "Custom Pattern Rules (lines 591-625)",
      "description": "Chapter documents custom pattern rules with detailed examples, but this feature is completely non-functional",
      "current_content": "Define project-specific patterns using custom rules:\n\n```toml\n[[patterns.custom_rules]]\nname = \"Repository Pattern\"\ndescription = \"Data access layer pattern\"\nmethod_pattern = \"^(find|save|update|delete|get)_.*\"\nclass_pattern = \".*Repository$\"\nconfidence = 0.75\n```\n\nAnd Example 3 (lines 861-904) demonstrates using custom rules",
      "reality": "CustomPatternRule struct exists in PatternConfig and can be parsed from TOML, but there is zero code that uses these rules to detect patterns. The feature is scaffolding only.",
      "fix_suggestion": "Remove entire 'Custom Pattern Rules' section (lines 591-625) and Example 3. If keeping, add prominent warning: 'This feature is planned but not yet implemented. Custom rules will be parsed but ignored.'",
      "source_reference": "src/analysis/patterns/config.rs:CustomPatternRule (defined but never used anywhere)"
    },
    {
      "type": "misleading_content",
      "severity": "high",
      "section": "Integration with Complexity Analysis (lines 745-785)",
      "description": "Chapter documents pattern-based complexity adjustments with specific multipliers but conflates two separate systems",
      "current_content": "| Role | Multiplier | Reasoning |\n|------|-----------|-----------|\n| Pattern Implementation | 0.6 | Boilerplate pattern code is less concerning |\n| Factory Method | 0.7 | Expected to have branching logic |\n| Observer Notification | 0.5 | Simple iteration over observers |\n| Template Method | 0.8 | Framework method with expected complexity |",
      "reality": "Two separate systems exist:\n1. User-facing design patterns (Observer, Singleton, etc.) detected by src/analysis/patterns/\n2. Python complexity patterns (DictionaryDispatch, StrategyPattern, etc.) in src/complexity/python_pattern_adjustments.rs with different multipliers (0.5-0.8)\n\nThe chapter documents hypothetical multipliers for design patterns, but actual complexity adjustments use python_pattern_adjustments.rs which detects different patterns.",
      "fix_suggestion": "Clarify two separate systems:\n1. Design pattern DETECTION (reports patterns found)\n2. Complexity pattern ADJUSTMENTS (adjusts scores using different internal patterns)\n\nVerify if/how PatternInstance results from design pattern detection actually integrate with complexity scoring.",
      "source_reference": "src/complexity/python_pattern_adjustments.rs:27-32 (actual adjustment factors for different patterns), src/analysis/patterns/mod.rs (design pattern detection)"
    },
    {
      "type": "incorrect_example",
      "severity": "medium",
      "section": "Use Cases - Architecture Documentation (lines 917-924)",
      "description": "Example shows '--patterns all' which is not a valid value",
      "current_content": "```bash\ndebtmap analyze --patterns all --show-pattern-warnings > architecture-report.txt\n```",
      "reality": "The --patterns flag accepts comma-separated pattern names: observer,singleton,factory,strategy,callback,template_method,dependency_injection. There is no 'all' shorthand value.",
      "fix_suggestion": "Replace with:\n```bash\ndebtmap analyze --show-pattern-warnings > architecture-report.txt\n```\nOr use explicit list of all 7 patterns.",
      "source_reference": "src/cli.rs:244-246 (--patterns accepts comma-separated list, no 'all' value)"
    },
    {
      "type": "incomplete_explanation",
      "severity": "medium",
      "section": "Confidence Scoring - How Confidence is Calculated (lines 647-661)",
      "description": "Example shows additive confidence calculation with specific weights that are arbitrary",
      "current_content": "Example confidence calculation for Observer pattern:\n- Base class with `ABC` marker: +0.3\n- Abstract methods present: +0.2\n- Concrete implementations found: +0.2\n- Registration methods detected: +0.15\n- Notification methods detected: +0.15\n- **Total**: 0.8 (High confidence)",
      "reality": "While confidence values are returned by recognizers, the specific weights (0.3, 0.2, 0.15) are not implemented as separate additive components. Each recognizer calculates confidence holistically based on its own internal logic.",
      "fix_suggestion": "Replace specific weight breakdown with: 'Confidence is calculated holistically based on: presence of abstract base class, number of implementations, detection of registration/notification methods, and naming conventions. Higher confidence requires more structural elements to be present.'",
      "source_reference": "src/analysis/patterns/observer.rs (confidence calculation is holistic)"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "CLI Options (lines 510-529)",
      "description": "Chapter doesn't document --show-pattern-warnings flag clearly or explain pattern output format",
      "should_add": "1. Explain what --show-pattern-warnings does (shows low-confidence detections below threshold)\n2. Document how detected patterns appear in output:\n   - terminal format: integrated into analysis output\n   - json format: includes pattern_instances field\n   - markdown format: patterns section",
      "fix_suggestion": "Add subsection 'Pattern Detection Output' explaining:\n- How patterns are displayed in different output formats\n- What --show-pattern-warnings reveals\n- Example output snippets",
      "source_reference": "src/output/pattern_formatter.rs, src/output/pattern_analysis.rs, src/cli.rs:253-254"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Overview table",
      "description": "Chapter states 'Debtmap detects 7 design patterns' but validation requirement says 'Check that all 8 design patterns are documented'",
      "reality": "Chapter correctly documents 7 user-facing patterns. Validation requirement appears to be incorrect (expecting 8 when there are 7).",
      "fix_suggestion": "Chapter is correct. Update validation requirement to check for 7 patterns, not 8.",
      "source_reference": "src/analysis/patterns/mod.rs:84-91 (7 recognizers)"
    }
  ],
  "positive_aspects": [
    "Accurate documentation of all 7 user-facing patterns (Observer, Singleton, Factory, Strategy, Callback, Template Method, Dependency Injection)",
    "Excellent, realistic code examples for each pattern showing what would actually be detected",
    "Correct explanation that Builder and Visitor are internal-only patterns (lines 433-507)",
    "Accurate CLI flag documentation for --no-pattern-detection, --patterns, --pattern-threshold (lines 514-529)",
    "Good explanation of cross-file pattern detection using CrossModuleContext (lines 663-706)",
    "Rust trait-based pattern detection correctly documented (lines 707-743)",
    "Confidence threshold ranges (0.5-1.0) and default (0.7) are accurate",
    "PatternType enum documented matches implementation exactly",
    "Troubleshooting section correctly notes Builder/Visitor not available via CLI (lines 958-968)",
    "Detection criteria for each pattern are accurate and match implementation",
    "Clear explanation of why Builder/Visitor are internal-only (lines 437-470, 473-507)"
  ],
  "improvement_suggestions": [
    "CRITICAL: Fix broken link to complexity-metrics.md at line 694",
    "CRITICAL: Remove or prominently mark configuration sections as non-functional. This is the most misleading content.",
    "CRITICAL: Remove custom pattern rules section entirely or mark as future feature",
    "Clarify two separate systems: (1) design pattern DETECTION for reporting, (2) complexity pattern ADJUSTMENTS for scoring",
    "Add section explaining actual integration: how detected patterns are output vs. how they affect other analyses",
    "Document pattern detection output format for terminal/json/markdown",
    "Add performance impact discussion: cost of pattern detection, when to disable",
    "Document language support matrix: which patterns work in which languages",
    "Add real output examples showing detected patterns in terminal and JSON",
    "Explain relationship between PatternInstance confidence and --pattern-threshold filtering",
    "Add note about pattern detection being analysis-time only (results not cached separately)",
    "Consider adding 'Implementation Status' badges: ✓ Implemented, ⚠ Partial, ✗ Planned"
  ],
  "metadata": {
    "analyzed_at": "2025-11-12T07:35:00Z",
    "feature_inventory": ".prodigy/book-analysis/features.json",
    "topics_covered": [
      "Observer pattern detection",
      "Singleton pattern detection",
      "Factory pattern detection",
      "Strategy pattern detection",
      "Callback pattern detection",
      "Template method pattern detection",
      "Dependency injection detection",
      "Builder pattern (internal)",
      "Visitor pattern (internal)",
      "Pattern confidence thresholds",
      "Configuration options"
    ],
    "validation_focus": "Check that all 8 design patterns are documented with detection criteria and examples",
    "validation_note": "Chapter correctly documents 7 user-facing patterns. Validation requirement expecting 8 appears incorrect.",
    "actual_user_facing_patterns": 7,
    "patterns_list": "observer, singleton, factory, strategy, callback, template_method, dependency_injection",
    "internal_patterns": 2,
    "internal_list": "builder (god object scoring), visitor (complexity normalization)",
    "critical_issue": "Configuration and custom rules extensively documented but non-functional",
    "internal_links_checked": {
      "total_links": 2,
      "broken_links": 1,
      "valid_links": 1,
      "links": [
        {
          "target": "./complexity-metrics.md",
          "status": "broken",
          "line": 694,
          "resolved_path": "book/src/complexity-metrics.md",
          "suggestion": "File does not exist. Update link or create file."
        },
        {
          "target": "./scoring-strategies.md",
          "status": "valid",
          "line": 695,
          "resolved_path": "book/src/scoring-strategies.md"
        }
      ]
    }
  }
}
