{
  "chapter_id": "cli-reference",
  "chapter_title": "CLI Reference",
  "chapter_file": "book/src/cli-reference.md",
  "drift_detected": true,
  "severity": "medium",
  "quality_assessment": "Chapter has excellent structure and covers most CLI options comprehensively, but is missing several recently added debugging and advanced features that exist in the codebase",
  "issues": [
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Debugging & Verbosity",
      "description": "Chapter missing --explain-metrics flag for explaining metric definitions and formulas",
      "should_add": "Document --explain-metrics flag that explains metric definitions (measured vs estimated)",
      "fix_suggestion": "Add to Debugging section: `--explain-metrics` - Explain metric definitions and formulas (measured vs estimated)",
      "source_reference": "src/cli.rs:253-254 - explain_metrics: bool field in Analyze command"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Debugging & Verbosity",
      "description": "Chapter missing advanced call graph debugging flags",
      "should_add": "Document --debug-call-graph, --trace-function, --call-graph-stats, --validate-call-graph, --debug-format flags",
      "fix_suggestion": "Add new subsection 'Call Graph Debugging' with: --debug-call-graph (enable detailed call graph debugging), --trace-function (trace specific functions during resolution), --call-graph-stats (show only statistics, no detailed list), --validate-call-graph (validate structure and report issues), --debug-format <FORMAT> (text or json, default: text)",
      "source_reference": "src/cli.rs:256-274 - debug_call_graph, trace_functions, call_graph_stats_only, validate_call_graph, debug_format fields"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Output Control",
      "description": "Chapter missing dependency display options for controlling caller/callee visibility",
      "should_add": "Document --show-dependencies, --no-dependencies, --max-callers, --max-callees, --show-external-calls, --show-std-lib-calls flags",
      "fix_suggestion": "Add new subsection 'Dependency Display Options': --show-dependencies (show caller/callee info in output), --no-dependencies (hide dependency information), --max-callers <N> (limit callers shown, default: 5), --max-callees <N> (limit callees shown, default: 5), --show-external-calls (include external crate calls in dependencies), --show-std-lib-calls (include standard library calls in dependencies)",
      "source_reference": "src/cli.rs:276-298 - show_dependencies, no_dependencies, max_callers, max_callees, show_external, show_std_lib fields"
    },
    {
      "type": "missing_content",
      "severity": "high",
      "section": "Analysis Control",
      "description": "Chapter missing AST-based functional composition analysis feature (spec 111)",
      "should_add": "Document --ast-functional-analysis and --functional-analysis-profile flags",
      "fix_suggestion": "Add to Analysis Control section: --ast-functional-analysis (enable AST-based functional composition analysis for spec 111), --functional-analysis-profile <PROFILE> (strict, balanced, or lenient - controls functional purity analysis thresholds)",
      "source_reference": "src/cli.rs:300-306 - ast_functional_analysis: bool, functional_analysis_profile: Option<FunctionalAnalysisProfile> fields"
    },
    {
      "type": "missing_content",
      "severity": "medium",
      "section": "Validate Command",
      "description": "Validate command missing --no-parallel and --jobs options in documentation",
      "should_add": "Document that validate command supports --no-parallel and --jobs flags for performance control",
      "fix_suggestion": "Add to validate command options under 'Performance Control': --no-parallel (disable parallel call graph construction, enabled by default), --jobs <N> (number of threads for parallel processing, 0 = use all cores, can also use DEBTMAP_JOBS env var)",
      "source_reference": "src/cli.rs:382-394 - Validate command includes no_parallel and jobs fields with detailed documentation"
    },
    {
      "type": "incomplete_explanation",
      "severity": "low",
      "section": "Compare Command",
      "description": "Compare command documented but mutual exclusivity of --plan and --target-location could be more explicit",
      "current_content": "**Note:** `--plan` and `--target-location` are mutually exclusive options. Using both together will cause a CLI error.",
      "should_be": "More prominent explanation showing example error message when both flags are used",
      "fix_suggestion": "Add example showing: 'error: the argument '--plan <FILE>' cannot be used with '--target-location <LOCATION>''",
      "source_reference": "src/cli.rs:413 - conflicts_with = \"plan\" annotation on target_location field"
    },
    {
      "type": "outdated_information",
      "severity": "low",
      "section": "Validate Command Options",
      "description": "Documentation doesn't explicitly show that validate command supports hidden/deprecated --explain-score flag",
      "current_content": "Validate command shows --verbose option",
      "should_be": "Should note that --explain-score is deprecated (hidden) in validate command, use --verbose instead",
      "fix_suggestion": "Add note in validate command that --explain-score exists but is deprecated (use -v, -vv, -vvv instead)",
      "source_reference": "src/cli.rs:371-373 - Validate has explain_score with hide = true attribute"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Command Compatibility Matrix",
      "description": "Compatibility matrix doesn't include new debugging and functional analysis options",
      "should_add": "Rows for --explain-metrics, --debug-call-graph, --trace-function, --validate-call-graph, --show-dependencies, --ast-functional-analysis, --max-callers, --max-callees",
      "fix_suggestion": "Expand compatibility matrix table to include all debugging flags and functional analysis options with their command compatibility",
      "source_reference": "src/cli.rs - Multiple new fields added that are not reflected in the compatibility matrix"
    },
    {
      "type": "missing_content",
      "severity": "low",
      "section": "Examples",
      "description": "No examples showing call graph debugging or functional analysis usage",
      "should_add": "Examples demonstrating --debug-call-graph, --validate-call-graph, --trace-function, and --ast-functional-analysis",
      "fix_suggestion": "Add 'Advanced Debugging' subsection to Examples with: debtmap analyze . --debug-call-graph --trace-function 'my_function' --debug-format json, and debtmap analyze . --ast-functional-analysis --functional-analysis-profile strict",
      "source_reference": "src/cli.rs:256-306 and src/commands/analyze.rs:383-516 - Implementation shows advanced debugging capabilities"
    }
  ],
  "positive_aspects": [
    "Comprehensive coverage of core commands (analyze, validate, compare, init)",
    "Well-organized option categories (Output, Analysis, Context, Performance, Caching, Debugging)",
    "Excellent examples section with real-world use cases and workflows",
    "Good troubleshooting section with practical solutions for common issues",
    "Clear documentation of deprecated options (--cache, --explain-score) with migration guidance",
    "Command compatibility matrix provides helpful quick reference",
    "Option aliases documented clearly (--lcov, --head, --enable-context)",
    "Environment variables documented (DEBTMAP_CACHE_DIR, DEBTMAP_JOBS)",
    "Best practices section provides actionable guidance for different scenarios",
    "Common workflows section demonstrates practical usage patterns",
    "Quick Start section provides immediate value for new users",
    "Default values are accurately documented throughout",
    "Code examples are syntactically correct and would execute properly",
    "Good balance between reference material and practical guidance",
    "Clear explanations of complex features like coverage integration and context-aware analysis"
  ],
  "improvement_suggestions": [
    "Add 'Call Graph Debugging' subsection to Debugging & Verbosity section with all call graph flags",
    "Add 'Dependency Display Options' subsection to Output Control section",
    "Document AST-based functional analysis feature in Analysis Control section with use cases",
    "Update Command Compatibility Matrix to include all current flags (9 missing flags identified)",
    "Add examples for new debugging features (call graph tracing, validation, functional analysis)",
    "Add 'Advanced Debugging Workflows' subsection showing combined use of debugging flags",
    "Document when to use different functional analysis profiles (strict for pure FP, lenient for imperative)",
    "Add troubleshooting entry for call graph resolution issues and how to debug them",
    "Consider grouping all call-graph-related flags together for easier discovery",
    "Add cross-references between related options (e.g., --debug-call-graph â†’ --validate-call-graph)",
    "Document the relationship between --jobs in analyze vs validate commands",
    "Add example showing DEBTMAP_JOBS environment variable usage as alternative to --jobs flag",
    "Consider adding a 'Recently Added Features' section highlighting new flags for existing users"
  ],
  "metadata": {
    "analyzed_at": "2025-10-25",
    "feature_inventory": ".debtmap/book-analysis/features.json",
    "topics_covered": [
      "Commands (analyze, init, validate, compare)",
      "Arguments and options",
      "Output formats",
      "Configuration",
      "Coverage integration",
      "Context-aware analysis",
      "Performance tuning",
      "Caching",
      "Debugging",
      "Troubleshooting",
      "Best practices",
      "Common workflows"
    ],
    "validation_focus": "Verify all CLI commands from src/cli/ are documented with current options",
    "code_files_reviewed": [
      "src/cli.rs (lines 1-625)",
      "src/commands/analyze.rs (lines 1-517)"
    ],
    "total_cli_options_in_code": {
      "analyze_command": 83,
      "validate_command": 22,
      "compare_command": 6,
      "init_command": 1
    },
    "documented_options_count": 74,
    "undocumented_options_count": 9,
    "undocumented_options_list": [
      "explain_metrics",
      "debug_call_graph",
      "trace_functions",
      "call_graph_stats_only",
      "validate_call_graph",
      "debug_format",
      "show_dependencies",
      "no_dependencies",
      "max_callers",
      "max_callees",
      "show_external",
      "show_std_lib",
      "ast_functional_analysis",
      "functional_analysis_profile"
    ],
    "documentation_accuracy": "89.2%",
    "drift_severity_breakdown": {
      "high": 3,
      "medium": 2,
      "low": 4
    }
  }
}
